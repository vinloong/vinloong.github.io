"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9566],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var p=a.createContext({}),u=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(p.Provider,{value:t},e.children)},k="mdxType",s={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,p=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),k=u(n),c=l,m=k["".concat(p,".").concat(c)]||k[c]||s[c]||r;return n?a.createElement(m,o(o({ref:t},d),{},{components:n})):a.createElement(m,o({ref:t},d))}));function m(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,o=new Array(r);o[0]=c;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i[k]="string"==typeof e?e:l,o[1]=i;for(var u=2;u<r;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},600:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>p,toc:()=>d});n(7294);var a=n(3905);function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},l.apply(this,arguments)}function r(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}const o={},i="\u5347\u7ea7\u96c6\u7fa4",p={unversionedId:"kubernetes/k8s-upgrade",id:"kubernetes/k8s-upgrade",title:"\u5347\u7ea7\u96c6\u7fa4",description:"k8s \u7248\u672c\u4fe1\u606f",source:"@site/docs/kubernetes/k8s-upgrade.md",sourceDirName:"kubernetes",slug:"/kubernetes/k8s-upgrade",permalink:"/docs/kubernetes/k8s-upgrade",draft:!1,tags:[],version:"current",lastUpdatedAt:1675912862,formattedLastUpdatedAt:"2023\u5e742\u67089\u65e5",frontMatter:{},sidebar:"kubernetes",previous:{title:"k8s-storageclass",permalink:"/docs/kubernetes/k8s-storageclass"},next:{title:"etcd faq",permalink:"/docs/kubernetes/k8s_etcd"}},u={},d=[{value:"k8s \u7248\u672c\u4fe1\u606f",id:"k8s-\u7248\u672c\u4fe1\u606f",level:2},{value:"k8s \u53d1\u884c\u7248\u4e0e github \u5206\u652f\u7684\u5173\u7cfb",id:"k8s-\u53d1\u884c\u7248\u4e0e-github-\u5206\u652f\u7684\u5173\u7cfb",level:3},{value:"\u6bcf\u4e2a\u7248\u672c\u7684\u652f\u6301\u5468\u671f",id:"\u6bcf\u4e2a\u7248\u672c\u7684\u652f\u6301\u5468\u671f",level:3},{value:"\u7248\u672c\u517c\u5bb9\u6027",id:"\u7248\u672c\u517c\u5bb9\u6027",level:2},{value:"kube-apiserver",id:"kube-apiserver",level:3},{value:"kubelet",id:"kubelet",level:3},{value:"kube-controller-manager\u3001 kube-scheduler \u548c cloud-controller-manager",id:"kube-controller-manager-kube-scheduler-\u548c-cloud-controller-manager",level:3},{value:"kubectl",id:"kubectl",level:3},{value:"\u5347\u7ea7\u96c6\u7fa4",id:"\u5347\u7ea7\u96c6\u7fa4-1",level:2},{value:"\u5347\u7ea7\u63a7\u5236\u8282\u70b9",id:"\u5347\u7ea7\u63a7\u5236\u8282\u70b9",level:3},{value:"\u5347\u7ea7\u4e3b\u63a7\u8282\u70b9",id:"\u5347\u7ea7\u4e3b\u63a7\u8282\u70b9",level:4},{value:"\u5347\u7ea7\u5176\u4ed6\u63a7\u5236\u8282\u70b9",id:"\u5347\u7ea7\u5176\u4ed6\u63a7\u5236\u8282\u70b9",level:4},{value:"\u5347\u7ea7 kubelet \u548c kubectl",id:"\u5347\u7ea7-kubelet-\u548c-kubectl",level:4},{value:"\u5347\u7ea7\u5de5\u4f5c\u8282\u70b9",id:"\u5347\u7ea7\u5de5\u4f5c\u8282\u70b9",level:3},{value:"\u5347\u7ea7 kubeadm",id:"\u5347\u7ea7-kubeadm",level:4},{value:"\u817e\u7a7a\u8282\u70b9",id:"\u817e\u7a7a\u8282\u70b9",level:4},{value:"\u5347\u7ea7 kubelet \u914d\u7f6e",id:"\u5347\u7ea7-kubelet-\u914d\u7f6e",level:4},{value:"\u5347\u7ea7 kubelet \u4e0e kubectl",id:"\u5347\u7ea7-kubelet-\u4e0e-kubectl",level:4},{value:"\u53d6\u6d88\u5bf9\u8282\u70b9\u7684\u4fdd\u62a4",id:"\u53d6\u6d88\u5bf9\u8282\u70b9\u7684\u4fdd\u62a4",level:3},{value:"\u9a8c\u8bc1\u96c6\u7fa4\u7684\u72b6\u6001",id:"\u9a8c\u8bc1\u96c6\u7fa4\u7684\u72b6\u6001",level:3},{value:"\u4ece\u6545\u969c\u72b6\u6001\u6062\u590d",id:"\u4ece\u6545\u969c\u72b6\u6001\u6062\u590d",level:2},{value:"\u5de5\u4f5c\u539f\u7406",id:"\u5de5\u4f5c\u539f\u7406",level:2},{value:"\u5f15\u7528",id:"\u5f15\u7528",level:2}],k={toc:d},s="wrapper";function c(e){var{components:t}=e,n=r(e,["components"]);return(0,a.kt)(s,l({},k,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",l({},{id:"\u5347\u7ea7\u96c6\u7fa4"}),"\u5347\u7ea7\u96c6\u7fa4"),(0,a.kt)("h2",l({},{id:"k8s-\u7248\u672c\u4fe1\u606f"}),"k8s \u7248\u672c\u4fe1\u606f"),(0,a.kt)("p",null,"k8s \u7248\u672c\u8868\u793a\u4e3a",(0,a.kt)("inlineCode",{parentName:"p"},"x.y.z"),"\uff0c\u5176\u4e2d",(0,a.kt)("inlineCode",{parentName:"p"},"x"),"\u662f\u4e3b\u8981\u7248\u672c\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"y"),"\u662f\u6b21\u8981\u7248\u672c\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"z"),"\u662f\u8865\u4e01\u7248\u672c\u3002"),(0,a.kt)("h3",l({},{id:"k8s-\u53d1\u884c\u7248\u4e0e-github-\u5206\u652f\u7684\u5173\u7cfb"}),"k8s \u53d1\u884c\u7248\u4e0e github \u5206\u652f\u7684\u5173\u7cfb"),(0,a.kt)("p",null,"master\u5206\u652f\u4e0a\u7684\u4ee3\u7801\u662f\u6700\u65b0\u7684\uff0c\u6bcf\u96942\u5468\u4f1a\u751f\u6210\u4e00\u4e2a\u53d1\u5e03\u7248\u672c(release)\uff0c\u7531\u65b0\u5230\u65e7\u4ee5\u6b64\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"master"),"--\x3e",(0,a.kt)("inlineCode",{parentName:"p"},"alpha"),"--\x3e",(0,a.kt)("inlineCode",{parentName:"p"},"beta"),"--\x3e",(0,a.kt)("inlineCode",{parentName:"p"},"Final release"),"\u3002",(0,a.kt)("inlineCode",{parentName:"p"},"X.Y.0"),"\u4e3a\u7a33\u5b9a\u7248\u672c\uff0c\u4e00\u4e2a",(0,a.kt)("inlineCode",{parentName:"p"},"X.Y.0"),"\u7248\u672c\u4f1a\u5728",(0,a.kt)("inlineCode",{parentName:"p"},"X.(Y-1).0"),"\u7248\u672c\u76843\u52304\u4e2a\u6708\u540e\u51fa\u73b0\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"X.Y.Z"),"\u4e3a\u89e3\u51b3\u4e86\u5fc5\u987b\u7684\u5b89\u5168\u6027\u6f0f\u6d1e\u3001\u4ee5\u53ca\u5f71\u54cd\u5927\u91cf\u7528\u6237\u7684\u65e0\u6cd5\u89e3\u51b3\u7684\u95ee\u9898\u7684\u8865\u4e01\u7248\u672c\u3002\u603b\u4f53\u800c\u8a00\uff0c\u6211\u4eec\u4e00\u822c\u5173\u5fc3",(0,a.kt)("inlineCode",{parentName:"p"},"X.Y.0"),"(\u7a33\u5b9a\u7248\u672c)\uff0c\u548c",(0,a.kt)("inlineCode",{parentName:"p"},"X.Y.Z"),"(\u8865\u4e01\u7248\u672c)\u7684\u7279\u6027\u3002"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"v1.14.0")," : ",(0,a.kt)("inlineCode",{parentName:"p"},"1"),"\u4e3a\u4e3b\u8981\u7248\u672c : ",(0,a.kt)("inlineCode",{parentName:"p"},"14"),"\u4e3a\u6b21\u8981\u7248\u672c : ",(0,a.kt)("inlineCode",{parentName:"p"},"0"),"\u4e3a\u8865\u4e01\u7248\u672c"),(0,a.kt)("h3",l({},{id:"\u6bcf\u4e2a\u7248\u672c\u7684\u652f\u6301\u5468\u671f"}),"\u6bcf\u4e2a\u7248\u672c\u7684\u652f\u6301\u5468\u671f"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"k8s")," \u9879\u76ee\u7ef4\u62a4\u6700\u65b0\u4e09\u4e2a\u6b21\u8981\u7248\u672c\u7684\u53d1\u5e03\u5206\u652f\u3002\u7ed3\u5408\u4e0a\u8ff0",(0,a.kt)("strong",{parentName:"p"},"\u4e00\u4e2a",(0,a.kt)("inlineCode",{parentName:"strong"},"X.Y.0"),"\u7248\u672c\u4f1a\u5728",(0,a.kt)("inlineCode",{parentName:"strong"},"X.(Y-1).0"),"\u7248\u672c\u76843\u52304\u4e2a\u6708\u540e\u51fa\u73b0"),"\u7684\u63cf\u8ff0\uff0c\u4e5f\u5c31\u662f\u8bf41\u5e74\u524d\u7684\u7248\u672c\u5c31\u4e0d\u518d\u7ef4\u62a4\uff0c\u6bcf\u4e2a\u6b21\u8981\u7248\u672c\u7684\u7ef4\u62a4\u5468\u671f\u4e3a9~12\u4e2a\u6708\uff0c\u5c31\u7b97\u6709\u5b89\u5168\u6f0f\u6d1e\u4e5f\u4e0d\u4f1a\u6709\u8865\u4e01\u7248\u672c."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"k8s")," \u9879\u76ee\u4f1a\u7ef4\u62a4\u6700\u8fd1\u7684\u4e09\u4e2a\u5c0f\u7248\u672c\u5206\u652f\uff081.23, 1.22, 1.21\uff09\u3002 ",(0,a.kt)("inlineCode",{parentName:"p"},"k8s")," 1.19 \u53ca\u66f4\u9ad8\u7684\u7248\u672c\u5c06\u83b7\u5f97\u5927\u7ea61\u5e74\u7684\u8865\u4e01\u652f\u6301\u3002 ",(0,a.kt)("inlineCode",{parentName:"p"},"k8s")," 1.18 \u53ca\u66f4\u65e9\u7684\u7248\u672c\u83b7\u5f97\u5927\u7ea69\u4e2a\u6708\u7684\u8865\u4e01\u652f\u6301\u3002"),(0,a.kt)("h2",l({},{id:"\u7248\u672c\u517c\u5bb9\u6027"}),"\u7248\u672c\u517c\u5bb9\u6027"),(0,a.kt)("h3",l({},{id:"kube-apiserver"}),"kube-apiserver"),(0,a.kt)("p",null,"\u5728\u9ad8\u53ef\u7528\u7684\u96c6\u7fa4\u4e2d\uff0c\u591a\u4e2a",(0,a.kt)("inlineCode",{parentName:"p"},"kube-apiserver")," \u5b9e\u4f8b\u7684\u5c0f\u7248\u672c\u53f7\u6700\u591a\u5dee 1"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u6bd4\u5982\u6211\u4eec\u7684\u96c6\u7fa4 ",(0,a.kt)("inlineCode",{parentName:"li"},"kube-apiserver")," \u7248\u672c\u53f7\u5982\u679c\u662f ",(0,a.kt)("strong",{parentName:"li"},"1.18")),(0,a.kt)("li",{parentName:"ul"},"\u5219\u53d7\u652f\u6301\u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"kube-apiserver")," \u7248\u672c\u53f7\u5305\u62ec ",(0,a.kt)("strong",{parentName:"li"},"1.18")," \u548c ",(0,a.kt)("strong",{parentName:"li"},"1.19"))),(0,a.kt)("h3",l({},{id:"kubelet"}),"kubelet"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"kubelet")," \u7248\u672c\u53f7\u4e0d\u80fd\u9ad8\u4e8e ",(0,a.kt)("inlineCode",{parentName:"p"},"kube-apiserver"),"\uff0c\u6700\u591a\u53ef\u4ee5\u6bd4 ",(0,a.kt)("inlineCode",{parentName:"p"},"kube-apiserver")," \u4f4e\u4e24\u4e2a\u5c0f\u7248\u672c\u3002"),(0,a.kt)("p",null,"\u4f8b\u5982\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"kube-apiserver")," \u7248\u672c\u53f7\u5982\u679c\u662f ",(0,a.kt)("strong",{parentName:"li"},"1.20")),(0,a.kt)("li",{parentName:"ul"},"\u53d7\u652f\u6301\u7684\u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"kubelet")," \u7248\u672c\u5c06\u5305\u62ec ",(0,a.kt)("strong",{parentName:"li"},"1.20"),"\u3001",(0,a.kt)("strong",{parentName:"li"},"1.19")," \u548c ",(0,a.kt)("strong",{parentName:"li"},"1.18"))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u5982\u679c HA \u96c6\u7fa4\u4e2d\u591a\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"kube-apiserver")," \u5b9e\u4f8b\u7248\u672c\u53f7\u4e0d\u4e00\u81f4\uff0c\u76f8\u5e94\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubelet")," \u7248\u672c\u53f7\u53ef\u9009\u8303\u56f4\u4e5f\u8981\u51cf\u5c0f")),(0,a.kt)("h3",l({},{id:"kube-controller-manager-kube-scheduler-\u548c-cloud-controller-manager"}),"kube-controller-manager\u3001 kube-scheduler \u548c cloud-controller-manager"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"kube-controller-manager"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"kube-scheduler")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"cloud-controller-manager")," \u7248\u672c\u4e0d\u80fd\u9ad8\u4e8e ",(0,a.kt)("inlineCode",{parentName:"p"},"kube-apiserver")," \u7248\u672c\u53f7\u3002 \u6700\u597d\u5b83\u4eec\u7684\u7248\u672c\u53f7\u4e0e ",(0,a.kt)("inlineCode",{parentName:"p"},"kube-apiserver")," \u4fdd\u6301\u4e00\u81f4\uff0c\u4f46\u5141\u8bb8\u6bd4 ",(0,a.kt)("inlineCode",{parentName:"p"},"kube-apiserver")," \u4f4e\u4e00\u4e2a\u5c0f\u7248\u672c\uff08\u4e3a\u4e86\u652f\u6301\u5728\u7ebf\u5347\u7ea7\uff09\u3002"),(0,a.kt)("p",null,"\u4f8b\u5982\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5982\u679c ",(0,a.kt)("inlineCode",{parentName:"li"},"kube-apiserver")," \u7248\u672c\u53f7\u4e3a ",(0,a.kt)("strong",{parentName:"li"},"1.20")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"kube-controller-manager"),"\u3001",(0,a.kt)("inlineCode",{parentName:"li"},"kube-scheduler")," \u548c ",(0,a.kt)("inlineCode",{parentName:"li"},"cloud-controller-manager")," \u7248\u672c\u652f\u6301 ",(0,a.kt)("strong",{parentName:"li"},"1.20")," \u548c ",(0,a.kt)("strong",{parentName:"li"},"1.19"))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("strong",{parentName:"p"},"\u8bf4\u660e\uff1a")," \u5982\u679c\u5728 HA \u96c6\u7fa4\u4e2d\uff0c\u591a\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"kube-apiserver")," \u5b9e\u4f8b\u7248\u672c\u53f7\u4e0d\u4e00\u81f4\uff0c\u4ed6\u4eec\u4e5f\u53ef\u4ee5\u8ddf\u4efb\u610f\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"kube-apiserver")," \u5b9e\u4f8b\u901a\u4fe1\uff08\u4f8b\u5982\uff0c\u901a\u8fc7 load balancer\uff09\uff0c \u4f46 ",(0,a.kt)("inlineCode",{parentName:"p"},"kube-controller-manager"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"kube-scheduler")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"cloud-controller-manager")," \u7248\u672c\u53ef\u7528\u8303\u56f4\u4f1a\u76f8\u5e94\u7684\u51cf\u5c0f\u3002")),(0,a.kt)("p",null,"\u4f8b\u5982\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"kube-apiserver")," \u5b9e\u4f8b\u540c\u65f6\u5b58\u5728 ",(0,a.kt)("strong",{parentName:"li"},"1.20")," \u548c ",(0,a.kt)("strong",{parentName:"li"},"1.21")," \u7248\u672c"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"kube-controller-manager"),"\u3001",(0,a.kt)("inlineCode",{parentName:"li"},"kube-scheduler")," \u548c ",(0,a.kt)("inlineCode",{parentName:"li"},"cloud-controller-manager")," \u53ef\u4ee5\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"li"},"load balancer")," \u4e0e\u6240\u6709\u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"kube-apiserver")," \u901a\u4fe1"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"kube-controller-manager"),"\u3001",(0,a.kt)("inlineCode",{parentName:"li"},"kube-scheduler")," \u548c ",(0,a.kt)("inlineCode",{parentName:"li"},"cloud-controller-manager")," \u53ef\u9009\u7248\u672c\u4e3a ",(0,a.kt)("strong",{parentName:"li"},"1.20")," \uff08\u4e0d\u652f\u6301",(0,a.kt)("strong",{parentName:"li"},"1.21")," \u56e0\u4e3a\u5b83\u6bd4  ",(0,a.kt)("inlineCode",{parentName:"li"},"kube-apiserver"),"  \u7684\u7248\u672c ",(0,a.kt)("strong",{parentName:"li"},"1.20")," \u65b0\uff09")),(0,a.kt)("h3",l({},{id:"kubectl"}),"kubectl"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"kubectl")," \u53ef\u4ee5\u6bd4 ",(0,a.kt)("inlineCode",{parentName:"p"},"kube-apiserver")," \u9ad8\u4e00\u4e2a\u5c0f\u7248\u672c\uff0c\u4e5f\u53ef\u4ee5\u4f4e\u4e00\u4e2a\u5c0f\u7248\u672c\u3002"),(0,a.kt)("p",null,"\u4f8b\u5982\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5982\u679c ",(0,a.kt)("inlineCode",{parentName:"li"},"kube-apiserver")," \u5f53\u524d\u662f ",(0,a.kt)("strong",{parentName:"li"},"1.22")," \u7248\u672c"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"kubectl")," \u5219\u652f\u6301 ",(0,a.kt)("strong",{parentName:"li"},"1.23"),"\u3001",(0,a.kt)("strong",{parentName:"li"},"1.22")," \u548c ",(0,a.kt)("strong",{parentName:"li"},"1.21"))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("strong",{parentName:"p"},"\u8bf4\u660e\uff1a")," \u5982\u679c HA \u96c6\u7fa4\u4e2d\u7684\u591a\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"kube-apiserver")," \u5b9e\u4f8b\u7248\u672c\u53f7\u4e0d\u4e00\u81f4\uff0c\u76f8\u5e94\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl")," \u53ef\u7528\u7248\u672c\u8303\u56f4\u4e5f\u4f1a\u51cf\u5c0f\u3002")),(0,a.kt)("p",null,"\u4f8b\u5982\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"kube-apiserver")," \u591a\u4e2a\u5b9e\u4f8b\u540c\u65f6\u5b58\u5728 ",(0,a.kt)("strong",{parentName:"li"},"1.23")," \u548c ",(0,a.kt)("strong",{parentName:"li"},"1.22")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"kubectl")," \u53ef\u9009\u7684\u7248\u672c\u4e3a ",(0,a.kt)("strong",{parentName:"li"},"1.23")," \u548c ",(0,a.kt)("strong",{parentName:"li"},"1.22"),"\uff08\u5176\u4ed6\u7248\u672c\u4e0d\u518d\u652f\u6301\uff0c\u56e0\u4e3a\u5b83\u4f1a\u6bd4\u5176\u4e2d\u67d0\u4e2a ",(0,a.kt)("inlineCode",{parentName:"li"},"kube-apiserver")," \u5b9e\u4f8b\u9ad8\u6216\u4f4e\u4e00\u4e2a\u5c0f\u7248\u672c")),(0,a.kt)("h2",l({},{id:"\u5347\u7ea7\u96c6\u7fa4-1"}),"\u5347\u7ea7\u96c6\u7fa4"),(0,a.kt)("p",null,"\u6211\u4eec\u96c6\u7fa4\u662f\u7531 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubeadm")," \u90e8\u7f72\u7684\uff0c\u7248\u672c\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"1.18.x"),",\u76ee\u524d\u6700\u65b0\u7248\u672c\u662f 1.23, \u6700\u65b0\u7a33\u5b9a\u7248\u662f 1.22"),(0,a.kt)("p",null,"\u4e0b\u9762\u8be6\u7ec6\u4ecb\u7ecd\u4e0b\u96c6\u7fa4\u4ece",(0,a.kt)("inlineCode",{parentName:"p"},"1.18.x")," \u7248\u672c\u5347\u7ea7\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"1.19.x"),"\uff0c\u7b80\u5355\u8bf4\u4e0b\u5176\u4ed6\u7248\u672c\u5347\u7ea7\u9700\u8981\u6ce8\u610f\u7684\u7ec6\u8282\u3002"),(0,a.kt)("p",null,"\u5907\u6ce8\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5347\u7ea7\u540e\uff0c\u56e0\u4e3a\u5bb9\u5668\u89c4\u7ea6\u7684\u54c8\u5e0c\u503c\u5df2\u66f4\u6539\uff0c\u6240\u6709\u5bb9\u5668\u90fd\u4f1a\u91cd\u542f\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u53ea\u80fd\u4ece\u4e00\u4e2a\u6b21\u7248\u672c\u5347\u7ea7\u5230\u4e0b\u4e00\u4e2a\u6b21\u7248\u672c\uff0c\u6216\u8005\u5728\u6b21\u7248\u672c\u76f8\u540c\u65f6\u5347\u7ea7\u8865\u4e01\u7248\u672c\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u5347\u7ea7\u65f6\u4e0d\u53ef\u4ee5\u8df3\u8fc7\u6b21\u7248\u672c\u3002 \u4f8b\u5982\uff0c\u4f60\u53ea\u80fd\u4ece ",(0,a.kt)("inlineCode",{parentName:"li"},"1.y")," \u5347\u7ea7\u5230",(0,a.kt)("inlineCode",{parentName:"li"}," 1.y+1"),"\uff0c\u800c\u4e0d\u80fd\u4ece from ",(0,a.kt)("inlineCode",{parentName:"li"},"1.y")," \u5347\u7ea7\u5230 ",(0,a.kt)("inlineCode",{parentName:"li"},"1.y+2"),"\u3002")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5347\u7ea7\u7684\u57fa\u672c\u6d41\u7a0b\uff1a")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u5148\u5347\u7ea7\u4e3b\u63a7\u5236\u5e73\u9762\u8282\u70b9\u518d\u5347\u7ea7\u5176\u4ed6\u63a7\u5236\u5e73\u9762\u8282\u70b9\u6700\u540e\u5347\u7ea7\u5de5\u4f5c\u8282\u70b9"),(0,a.kt)("li",{parentName:"ol"},"\u5148\u5347\u7ea7 ",(0,a.kt)("inlineCode",{parentName:"li"},"kube-apiserver")," \u518d\u5347\u7ea7 ",(0,a.kt)("inlineCode",{parentName:"li"},"kube-controller-manager"),"\u3001",(0,a.kt)("inlineCode",{parentName:"li"},"kube-scheduler")," \u7136\u540e\u5347\u7ea7 ",(0,a.kt)("inlineCode",{parentName:"li"},"kubelet"),"\u6700\u540e\u5347\u7ea7 ",(0,a.kt)("inlineCode",{parentName:"li"},"kube-proxy"))),(0,a.kt)("h3",l({},{id:"\u5347\u7ea7\u63a7\u5236\u8282\u70b9"}),"\u5347\u7ea7\u63a7\u5236\u8282\u70b9"),(0,a.kt)("h4",l({},{id:"\u5347\u7ea7\u4e3b\u63a7\u8282\u70b9"}),"\u5347\u7ea7\u4e3b\u63a7\u8282\u70b9"),(0,a.kt)("pre",null,(0,a.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"apt update\napt-cache policy kubeadm\n# \u7528\u6700\u65b0\u7684\u4fee\u8865\u7a0b\u5e8f\u7248\u672c\u66ff\u6362 1.19.x-00 \u4e2d\u7684 x\napt-mark unhold kubeadm && \\\napt-get update && apt-get install -y kubeadm=1.19.x-00 && \\\napt-mark hold kubeadm\n\n# \u4ece apt-get 1.1 \u7248\u672c\u8d77\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u65b9\u6cd5\napt-get update && \\\napt-get install -y --allow-change-held-packages kubeadm=1.19.x-00\n")),(0,a.kt)("p",null,"\u5347\u7ea7\u5b8c\u6210\uff0c\u9a8c\u8bc1\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"kubeadm version\n")),(0,a.kt)("p",null,"\u817e\u7a7a\u63a7\u5236\u5e73\u9762\u8282\u70b9:"),(0,a.kt)("pre",null,(0,a.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"# \u5c06 <cp-node-name> \u66ff\u6362\u4e3a\u4f60\u81ea\u5df1\u7684\u63a7\u5236\u9762\u8282\u70b9\u540d\u79f0\nkubectl drain <cp-node-name> --ignore-daemonsets\n")),(0,a.kt)("p",null,"\u68c0\u67e5\u96c6\u7fa4\u662f\u5426\u53ef\u4ee5\u5347\u7ea7\uff0c\u5e76\u53ef\u4ee5\u83b7\u53d6\u5230\u5347\u7ea7\u7684\u7248\u672c"),(0,a.kt)("pre",null,(0,a.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"sudo kubeadm upgrade plan\n")),(0,a.kt)("p",null,"\u7c7b\u4f3c\u4e0b\u9762\u7684\u8f93\u51fa\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",l({parentName:"pre"},{}),'[upgrade/config] Making sure the configuration is correct:\n[upgrade/config] Reading configuration from the cluster...\n[upgrade/config] FYI: You can look at this config file with \'kubectl -n kube-system get cm kubeadm-config -oyaml\'\n[preflight] Running pre-flight checks.\n[upgrade] Running cluster health checks\n[upgrade] Fetching available versions to upgrade to\n[upgrade/versions] Cluster version: v1.18.4\n[upgrade/versions] kubeadm version: v1.19.0\n[upgrade/versions] Latest stable version: v1.19.0\n[upgrade/versions] Latest version in the v1.18 series: v1.18.4\n\nComponents that must be upgraded manually after you have upgraded the control plane with \'kubeadm upgrade apply\':\nCOMPONENT   CURRENT             AVAILABLE\nKubelet     1 x v1.18.4         v1.19.0\n\nUpgrade to the latest version in the v1.18 series:\n\nCOMPONENT            CURRENT   AVAILABLE\nAPI Server           v1.18.4   v1.19.0\nController Manager   v1.18.4   v1.19.0\nScheduler            v1.18.4   v1.19.0\nKube Proxy           v1.18.4   v1.19.0\nCoreDNS              1.6.7     1.7.0\nEtcd                 3.4.3-0   3.4.7-0\n\nYou can now apply the upgrade by executing the following command:\n\n    kubeadm upgrade apply v1.19.0\n\n_____________________________________________________________________\n\n  The table below shows the current state of component configs as understood by this version of kubeadm.\n  Configs that have a "yes" mark in the "MANUAL UPGRADE REQUIRED" column require manual config upgrade or\n  resetting to kubeadm defaults before a successful upgrade can be performed. The version to manually\n  upgrade to is denoted in the "PREFERRED VERSION" column.\n\n  API GROUP                 CURRENT VERSION   PREFERRED VERSION   MANUAL UPGRADE REQUIRED\n  kubeproxy.config.k8s.io   v1alpha1          v1alpha1            no\n  kubelet.config.k8s.io     v1beta1           v1beta1             no\n  _____________________________________________________________________\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("strong",{parentName:"p"},"\u8bf4\u660e\uff1a"),"\u5982\u679c ",(0,a.kt)("inlineCode",{parentName:"p"},"kubeadm upgrade plan")," \u663e\u793a\u6709\u4efb\u4f55\u7ec4\u4ef6\u914d\u7f6e\u9700\u8981\u624b\u52a8\u5347\u7ea7\uff0c\u5219\u7528\u6237\u5fc5\u987b \u901a\u8fc7\u547d\u4ee4\u884c\u53c2\u6570 ",(0,a.kt)("inlineCode",{parentName:"p"},"--config")," \u7ed9 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubeadm upgrade apply")," \u64cd\u4f5c \u63d0\u4f9b\u5e26\u6709\u66ff\u6362\u914d\u7f6e\u7684\u914d\u7f6e\u6587\u4ef6\u3002")),(0,a.kt)("p",null,"\u5347\u7ea7\u52301.19\u7248\u672c"),(0,a.kt)("pre",null,(0,a.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"# \u5c06 x \u66ff\u6362\u4e3a\u4f60\u4e3a\u6b64\u6b21\u5347\u7ea7\u6240\u9009\u7684\u8865\u4e01\u7248\u672c\u53f7\nsudo kubeadm upgrade apply v1.19.x\n")),(0,a.kt)("p",null,"\u770b\u5230\u7c7b\u4f3c\u4e0b\u9762\u7684\u8f93\u51fa\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",l({parentName:"pre"},{}),'[upgrade/config] Making sure the configuration is correct:\n[upgrade/config] Reading configuration from the cluster...\n[upgrade/config] FYI: You can look at this config file with \'kubectl -n kube-system get cm kubeadm-config -oyaml\'\n[preflight] Running pre-flight checks.\n[upgrade] Running cluster health checks\n[upgrade/version] You have chosen to change the cluster version to "v1.19.0"\n[upgrade/versions] Cluster version: v1.18.4\n[upgrade/versions] kubeadm version: v1.19.0\n[upgrade/confirm] Are you sure you want to proceed with the upgrade? [y/N]: y\n[upgrade/prepull] Pulling images required for setting up a Kubernetes cluster\n[upgrade/prepull] This might take a minute or two, depending on the speed of your internet connection\n[upgrade/prepull] You can also perform this action in beforehand using \'kubeadm config images pull\'\n[upgrade/apply] Upgrading your Static Pod-hosted control plane to version "v1.19.0"...\nStatic pod: kube-apiserver-kind-control-plane hash: b4c8effe84b4a70031f9a49a20c8b003\nStatic pod: kube-controller-manager-kind-control-plane hash: 9ac092f0ca813f648c61c4d5fcbf39f2\nStatic pod: kube-scheduler-kind-control-plane hash: 7da02f2c78da17af7c2bf1533ecf8c9a\n[upgrade/etcd] Upgrading to TLS for etcd\nStatic pod: etcd-kind-control-plane hash: 171c56cd0e81c0db85e65d70361ceddf\n[upgrade/staticpods] Preparing for "etcd" upgrade\n[upgrade/staticpods] Renewing etcd-server certificate\n[upgrade/staticpods] Renewing etcd-peer certificate\n[upgrade/staticpods] Renewing etcd-healthcheck-client certificate\n[upgrade/staticpods] Moved new manifest to "/etc/kubernetes/manifests/etcd.yaml" and backed up old manifest to "/etc/kubernetes/tmp/kubeadm-backup-manifests-2020-07-13-16-24-16/etcd.yaml"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)\nStatic pod: etcd-kind-control-plane hash: 171c56cd0e81c0db85e65d70361ceddf\nStatic pod: etcd-kind-control-plane hash: 171c56cd0e81c0db85e65d70361ceddf\nStatic pod: etcd-kind-control-plane hash: 59e40b2aab1cd7055e64450b5ee438f0\n[apiclient] Found 1 Pods for label selector component=etcd\n[upgrade/staticpods] Component "etcd" upgraded successfully!\n[upgrade/etcd] Waiting for etcd to become available\n[upgrade/staticpods] Writing new Static Pod manifests to "/etc/kubernetes/tmp/kubeadm-upgraded-manifests999800980"\n[upgrade/staticpods] Preparing for "kube-apiserver" upgrade\n[upgrade/staticpods] Renewing apiserver certificate\n[upgrade/staticpods] Renewing apiserver-kubelet-client certificate\n[upgrade/staticpods] Renewing front-proxy-client certificate\n[upgrade/staticpods] Renewing apiserver-etcd-client certificate\n[upgrade/staticpods] Moved new manifest to "/etc/kubernetes/manifests/kube-apiserver.yaml" and backed up old manifest to "/etc/kubernetes/tmp/kubeadm-backup-manifests-2020-07-13-16-24-16/kube-apiserver.yaml"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)\nStatic pod: kube-apiserver-kind-control-plane hash: b4c8effe84b4a70031f9a49a20c8b003\nStatic pod: kube-apiserver-kind-control-plane hash: b4c8effe84b4a70031f9a49a20c8b003\nStatic pod: kube-apiserver-kind-control-plane hash: b4c8effe84b4a70031f9a49a20c8b003\nStatic pod: kube-apiserver-kind-control-plane hash: b4c8effe84b4a70031f9a49a20c8b003\nStatic pod: kube-apiserver-kind-control-plane hash: f717874150ba572f020dcd89db8480fc\n[apiclient] Found 1 Pods for label selector component=kube-apiserver\n[upgrade/staticpods] Component "kube-apiserver" upgraded successfully!\n[upgrade/staticpods] Preparing for "kube-controller-manager" upgrade\n[upgrade/staticpods] Renewing controller-manager.conf certificate\n[upgrade/staticpods] Moved new manifest to "/etc/kubernetes/manifests/kube-controller-manager.yaml" and backed up old manifest to "/etc/kubernetes/tmp/kubeadm-backup-manifests-2020-07-13-16-24-16/kube-controller-manager.yaml"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)\nStatic pod: kube-controller-manager-kind-control-plane hash: 9ac092f0ca813f648c61c4d5fcbf39f2\nStatic pod: kube-controller-manager-kind-control-plane hash: b155b63c70e798b806e64a866e297dd0\n[apiclient] Found 1 Pods for label selector component=kube-controller-manager\n[upgrade/staticpods] Component "kube-controller-manager" upgraded successfully!\n[upgrade/staticpods] Preparing for "kube-scheduler" upgrade\n[upgrade/staticpods] Renewing scheduler.conf certificate\n[upgrade/staticpods] Moved new manifest to "/etc/kubernetes/manifests/kube-scheduler.yaml" and backed up old manifest to "/etc/kubernetes/tmp/kubeadm-backup-manifests-2020-07-13-16-24-16/kube-scheduler.yaml"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)\nStatic pod: kube-scheduler-kind-control-plane hash: 7da02f2c78da17af7c2bf1533ecf8c9a\nStatic pod: kube-scheduler-kind-control-plane hash: 260018ac854dbf1c9fe82493e88aec31\n[apiclient] Found 1 Pods for label selector component=kube-scheduler\n[upgrade/staticpods] Component "kube-scheduler" upgraded successfully!\n[upload-config] Storing the configuration used in ConfigMap "kubeadm-config" in the "kube-system" Namespace\n[kubelet] Creating a ConfigMap "kubelet-config-1.19" in namespace kube-system with the configuration for the kubelets in the cluster\n[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"\n[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes\n[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials\n[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster\nW0713 16:26:14.074656    2986 dns.go:282] the CoreDNS Configuration will not be migrated due to unsupported version of CoreDNS. The existing CoreDNS Corefile configuration and deployment has been retained.\n[addons] Applied essential addon: CoreDNS\n[addons] Applied essential addon: kube-proxy\n\n[upgrade/successful] SUCCESS! Your cluster was upgraded to "v1.19.0". Enjoy!\n\n[upgrade/kubelet] Now that your control plane is upgraded, please proceed with upgrading your kubelets if you haven\'t already done so.\n')),(0,a.kt)("p",null,"\u4e0b\u9762\u624b\u52a8\u5347\u7ea7 ",(0,a.kt)("inlineCode",{parentName:"p"},"CNI"),"\u9a71\u52a8\u63d2\u4ef6;"),(0,a.kt)("p",null,"\u53d6\u6d88\u5bf9\u63a7\u5236\u9762\u8282\u70b9\u7684\u4fdd\u62a4:"),(0,a.kt)("pre",null,(0,a.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"# \u5c06 <cp-node-name> \u66ff\u6362\u4e3a\u4f60\u7684\u63a7\u5236\u9762\u8282\u70b9\u540d\u79f0\nkubectl uncordon <cp-node-name>\n")),(0,a.kt)("h4",l({},{id:"\u5347\u7ea7\u5176\u4ed6\u63a7\u5236\u8282\u70b9"}),"\u5347\u7ea7\u5176\u4ed6\u63a7\u5236\u8282\u70b9"),(0,a.kt)("p",null,"\u4e0e\u7b2c\u4e00\u4e2a\u63a7\u5236\u9762\u8282\u70b9\u7c7b\u4f3c\uff0c\u4e0d\u8fc7\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",l({parentName:"pre"},{}),"sudo kubeadm upgrade node\n")),(0,a.kt)("p",null,"\u540c\u65f6\uff0c\u4e5f\u4e0d\u9700\u8981\u6267\u884c ",(0,a.kt)("inlineCode",{parentName:"p"},"sudo kubeadm upgrade plan")),(0,a.kt)("h4",l({},{id:"\u5347\u7ea7-kubelet-\u548c-kubectl"}),"\u5347\u7ea7 kubelet \u548c kubectl"),(0,a.kt)("pre",null,(0,a.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"# \u7528\u6700\u65b0\u7684\u8865\u4e01\u7248\u672c\u66ff\u6362 1.19.x-00 \u4e2d\u7684 x\napt-mark unhold kubelet kubectl && \\\napt-get update && apt-get install -y kubelet=1.19.x-00 kubectl=1.19.x-00 && \\\napt-mark hold kubelet kubectl\n\n# \u4ece apt-get \u7684 1.1 \u7248\u672c\u5f00\u59cb\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u65b9\u6cd5\uff1a\n\napt-get update && \\\napt-get install -y --allow-change-held-packages kubelet=1.19.x-00 kubectl=1.19.x-00\n")),(0,a.kt)("p",null,"\u91cd\u542f kubelet"),(0,a.kt)("pre",null,(0,a.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"sudo systemctl daemon-reload\nsudo systemctl restart kubelet\n")),(0,a.kt)("h3",l({},{id:"\u5347\u7ea7\u5de5\u4f5c\u8282\u70b9"}),"\u5347\u7ea7\u5de5\u4f5c\u8282\u70b9"),(0,a.kt)("p",null,"\u5de5\u4f5c\u8282\u70b9\u4e0a\u7684\u5347\u7ea7\u8fc7\u7a0b\u5e94\u8be5\u4e00\u6b21\u6267\u884c\u4e00\u4e2a\u8282\u70b9\uff0c\u6216\u8005\u4e00\u6b21\u6267\u884c\u51e0\u4e2a\u8282\u70b9\uff0c \u4ee5\u4e0d\u5f71\u54cd\u8fd0\u884c\u5de5\u4f5c\u8d1f\u8f7d\u6240\u9700\u7684\u6700\u5c0f\u5bb9\u91cf"),(0,a.kt)("h4",l({},{id:"\u5347\u7ea7-kubeadm"}),"\u5347\u7ea7 kubeadm"),(0,a.kt)("p",null,"\u5728\u6240\u6709\u5de5\u4f5c\u8282\u70b9\u5347\u7ea7 kubeadm:"),(0,a.kt)("pre",null,(0,a.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"# \u5c06 1.19.x-00 \u4e2d\u7684 x \u66ff\u6362\u4e3a\u6700\u65b0\u7684\u8865\u4e01\u7248\u672c\napt-mark unhold kubeadm && \\\napt-get update && apt-get install -y kubeadm=1.19.x-00 && \\\napt-mark hold kubeadm\n\n# \u4ece apt-get \u7684 1.1 \u7248\u672c\u5f00\u59cb\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u65b9\u6cd5\uff1a\n\napt-get update && \\\napt-get install -y --allow-change-held-packages kubeadm=1.19.x-00\n")),(0,a.kt)("h4",l({},{id:"\u817e\u7a7a\u8282\u70b9"}),"\u817e\u7a7a\u8282\u70b9"),(0,a.kt)("p",null,"\u901a\u8fc7\u5c06\u8282\u70b9\u6807\u8bb0\u4e3a\u4e0d\u53ef\u8c03\u5ea6\u5e76\u9010\u51fa\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u4e3a\u7ef4\u62a4\u505a\u597d\u51c6\u5907\u3002\u8fd0\u884c\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"# \u5c06 <node-to-drain> \u66ff\u6362\u4e3a\u4f60\u6b63\u5728\u817e\u7a7a\u7684\u8282\u70b9\u7684\u540d\u79f0\nkubectl drain <node-to-drain> --ignore-daemonsets\n")),(0,a.kt)("p",null,"\u4f60\u5e94\u8be5\u53ef\u4ee5\u770b\u89c1\u4e0e\u4e0b\u9762\u7c7b\u4f3c\u7684\u8f93\u51fa\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"node/ip-172-31-85-18 cordoned\nWARNING: ignoring DaemonSet-managed Pods: kube-system/kube-proxy-dj7d7, kube-system/weave-net-z65qx\nnode/ip-172-31-85-18 drained\n")),(0,a.kt)("h4",l({},{id:"\u5347\u7ea7-kubelet-\u914d\u7f6e"}),"\u5347\u7ea7 kubelet \u914d\u7f6e"),(0,a.kt)("p",null,"\u5347\u7ea7 kubelet \u914d\u7f6e:"),(0,a.kt)("pre",null,(0,a.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"sudo kubeadm upgrade node\n")),(0,a.kt)("h4",l({},{id:"\u5347\u7ea7-kubelet-\u4e0e-kubectl"}),"\u5347\u7ea7 kubelet \u4e0e kubectl"),(0,a.kt)("p",null,"\u5728\u6240\u6709\u5de5\u4f5c\u8282\u70b9\u4e0a\u5347\u7ea7 kubelet \u548c kubectl\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"# \u5c06 1.19.x-00 \u4e2d\u7684 x \u66ff\u6362\u4e3a\u6700\u65b0\u7684\u8865\u4e01\u7248\u672c\napt-mark unhold kubelet kubectl && \\\napt-get update && apt-get install -y kubelet=1.19.x-00 kubectl=1.19.x-00 && \\\napt-mark hold kubelet kubectl\n\n# \u4ece apt-get \u7684 1.1 \u7248\u672c\u5f00\u59cb\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u65b9\u6cd5\uff1a\n\napt-get update && \\\napt-get install -y --allow-change-held-packages kubelet=1.19.x-00 kubectl=1.19.x-00\n")),(0,a.kt)("p",null,"\u91cd\u542f kubelet"),(0,a.kt)("pre",null,(0,a.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"sudo systemctl daemon-reload\nsudo systemctl restart kubelet\n")),(0,a.kt)("h3",l({},{id:"\u53d6\u6d88\u5bf9\u8282\u70b9\u7684\u4fdd\u62a4"}),"\u53d6\u6d88\u5bf9\u8282\u70b9\u7684\u4fdd\u62a4"),(0,a.kt)("p",null,"\u901a\u8fc7\u5c06\u8282\u70b9\u6807\u8bb0\u4e3a\u53ef\u8c03\u5ea6\uff0c\u8ba9\u8282\u70b9\u91cd\u65b0\u4e0a\u7ebf:"),(0,a.kt)("pre",null,(0,a.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"# \u5c06 <node-to-drain> \u66ff\u6362\u4e3a\u5f53\u524d\u8282\u70b9\u7684\u540d\u79f0\nkubectl uncordon <node-to-drain>\n")),(0,a.kt)("h3",l({},{id:"\u9a8c\u8bc1\u96c6\u7fa4\u7684\u72b6\u6001"}),"\u9a8c\u8bc1\u96c6\u7fa4\u7684\u72b6\u6001"),(0,a.kt)("p",null,"\u5728\u6240\u6709\u8282\u70b9\u4e0a\u5347\u7ea7 kubelet \u540e\uff0c\u901a\u8fc7\u4ece kubectl \u53ef\u4ee5\u8bbf\u95ee\u96c6\u7fa4\u7684\u4efb\u4f55\u4f4d\u7f6e\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u9a8c\u8bc1\u6240\u6709\u8282\u70b9\u662f\u5426\u518d\u6b21\u53ef\u7528\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"kubectl get nodes\n")),(0,a.kt)("h2",l({},{id:"\u4ece\u6545\u969c\u72b6\u6001\u6062\u590d"}),"\u4ece\u6545\u969c\u72b6\u6001\u6062\u590d"),(0,a.kt)("p",null,"\u5982\u679c ",(0,a.kt)("inlineCode",{parentName:"p"},"kubeadm upgrade")," \u5931\u8d25\u5e76\u4e14\u6ca1\u6709\u56de\u6eda\uff0c\u4f8b\u5982\u7531\u4e8e\u6267\u884c\u671f\u95f4\u610f\u5916\u5173\u95ed\uff0c\u4f60\u53ef\u4ee5\u518d\u6b21\u8fd0\u884c ",(0,a.kt)("inlineCode",{parentName:"p"},"kubeadm upgrade"),"\u3002 \u6b64\u547d\u4ee4\u662f\u5e42\u7b49\u7684\uff0c\u5e76\u6700\u7ec8\u786e\u4fdd\u5b9e\u9645\u72b6\u6001\u662f\u4f60\u58f0\u660e\u7684\u6240\u9700\u72b6\u6001\u3002 \u8981\u4ece\u6545\u969c\u72b6\u6001\u6062\u590d\uff0c\u4f60\u8fd8\u53ef\u4ee5\u8fd0\u884c ",(0,a.kt)("inlineCode",{parentName:"p"},"kubeadm upgrade --force")," \u800c\u4e0d\u53bb\u66f4\u6539\u96c6\u7fa4\u6b63\u5728\u8fd0\u884c\u7684\u7248\u672c\u3002"),(0,a.kt)("p",null,"\u5728\u5347\u7ea7\u671f\u95f4\uff0ckubeadm \u5411 ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/kubernetes/tmp")," \u76ee\u5f55\u4e0b\u7684\u5982\u4e0b\u5907\u4efd\u6587\u4ef6\u5939\u5199\u5165\u6570\u636e\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"kubeadm-backup-etcd-<date>-<time>")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"kubeadm-backup-manifests-<date>-<time>"))),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"kubeadm-backup-etcd")," \u5305\u542b\u5f53\u524d\u63a7\u5236\u9762\u8282\u70b9\u672c\u5730 etcd \u6210\u5458\u6570\u636e\u7684\u5907\u4efd\u3002 \u5982\u679c etcd \u5347\u7ea7\u5931\u8d25\u5e76\u4e14\u81ea\u52a8\u56de\u6eda\u4e5f\u65e0\u6cd5\u4fee\u590d\uff0c\u5219\u53ef\u4ee5\u5c06\u6b64\u6587\u4ef6\u5939\u4e2d\u7684\u5185\u5bb9\u590d\u5236\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"/var/lib/etcd")," \u8fdb\u884c\u624b\u5de5\u4fee\u590d\u3002\u5982\u679c\u4f7f\u7528\u7684\u662f\u5916\u90e8\u7684 etcd\uff0c\u5219\u6b64\u5907\u4efd\u6587\u4ef6\u5939\u4e3a\u7a7a\u3002"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"kubeadm-backup-manifests")," \u5305\u542b\u5f53\u524d\u63a7\u5236\u9762\u8282\u70b9\u7684\u9759\u6001 Pod \u6e05\u5355\u6587\u4ef6\u7684\u5907\u4efd\u7248\u672c\u3002 \u5982\u679c\u5347\u7ea7\u5931\u8d25\u5e76\u4e14\u65e0\u6cd5\u81ea\u52a8\u56de\u6eda\uff0c\u5219\u6b64\u6587\u4ef6\u5939\u4e2d\u7684\u5185\u5bb9\u53ef\u4ee5\u590d\u5236\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/kubernetes/manifests")," \u76ee\u5f55\u5b9e\u73b0\u624b\u5de5\u6062\u590d\u3002 \u5982\u679c\u7531\u4e8e\u67d0\u4e9b\u539f\u56e0\uff0c\u5728\u5347\u7ea7\u524d\u540e\u67d0\u4e2a\u7ec4\u4ef6\u7684\u6e05\u5355\u672a\u53d1\u751f\u53d8\u5316\uff0c\u5219 kubeadm \u4e5f\u4e0d\u4f1a\u4e3a\u4e4b \u751f\u6210\u5907\u4efd\u7248\u672c\u3002"),(0,a.kt)("h2",l({},{id:"\u5de5\u4f5c\u539f\u7406"}),"\u5de5\u4f5c\u539f\u7406"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"kubeadm upgrade apply")," \u505a\u4e86\u4ee5\u4e0b\u5de5\u4f5c\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u68c0\u67e5\u4f60\u7684\u96c6\u7fa4\u662f\u5426\u5904\u4e8e\u53ef\u5347\u7ea7\u72b6\u6001:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"API \u670d\u52a1\u5668\u662f\u53ef\u8bbf\u95ee\u7684"),(0,a.kt)("li",{parentName:"ul"},"\u6240\u6709\u8282\u70b9\u5904\u4e8e ",(0,a.kt)("inlineCode",{parentName:"li"},"Ready")," \u72b6\u6001"),(0,a.kt)("li",{parentName:"ul"},"\u63a7\u5236\u9762\u662f\u5065\u5eb7\u7684"))),(0,a.kt)("li",{parentName:"ul"},"\u5f3a\u5236\u6267\u884c\u7248\u672c\u504f\u5dee\u7b56\u7565\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u786e\u4fdd\u63a7\u5236\u9762\u7684\u955c\u50cf\u662f\u53ef\u7528\u7684\u6216\u53ef\u62c9\u53d6\u5230\u670d\u52a1\u5668\u4e0a\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u5982\u679c\u7ec4\u4ef6\u914d\u7f6e\u8981\u6c42\u7248\u672c\u5347\u7ea7\uff0c\u5219\u751f\u6210\u66ff\u4ee3\u914d\u7f6e\u4e0e/\u6216\u4f7f\u7528\u7528\u6237\u63d0\u4f9b\u7684\u8986\u76d6\u7248\u672c\u914d\u7f6e\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u5347\u7ea7\u63a7\u5236\u9762\u7ec4\u4ef6\u6216\u56de\u6eda\uff08\u5982\u679c\u5176\u4e2d\u4efb\u4f55\u4e00\u4e2a\u7ec4\u4ef6\u65e0\u6cd5\u542f\u52a8\uff09\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u5e94\u7528\u65b0\u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"kube-dns")," \u548c ",(0,a.kt)("inlineCode",{parentName:"li"},"kube-proxy")," \u6e05\u5355\uff0c\u5e76\u5f3a\u5236\u521b\u5efa\u6240\u6709\u5fc5\u9700\u7684 RBAC \u89c4\u5219\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u5982\u679c\u65e7\u6587\u4ef6\u5728 180 \u5929\u540e\u8fc7\u671f\uff0c\u5c06\u521b\u5efa API \u670d\u52a1\u5668\u7684\u65b0\u8bc1\u4e66\u548c\u5bc6\u94a5\u6587\u4ef6\u5e76\u5907\u4efd\u65e7\u6587\u4ef6\u3002")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"kubeadm upgrade node")," \u5728\u5176\u4ed6\u63a7\u5236\u5e73\u8282\u70b9\u4e0a\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4ece\u96c6\u7fa4\u4e2d\u83b7\u53d6 kubeadm ",(0,a.kt)("inlineCode",{parentName:"li"},"ClusterConfiguration"),"\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u53ef\u9009\u5730\u5907\u4efd kube-apiserver \u8bc1\u4e66\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u5347\u7ea7\u63a7\u5236\u5e73\u9762\u7ec4\u4ef6\u7684\u9759\u6001 Pod \u6e05\u5355\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u4e3a\u672c\u8282\u70b9\u5347\u7ea7 kubelet \u914d\u7f6e")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"kubeadm upgrade node")," \u5728\u5de5\u4f5c\u8282\u70b9\u4e0a\u5b8c\u6210\u4ee5\u4e0b\u5de5\u4f5c\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4ece\u96c6\u7fa4\u53d6\u56de kubeadm ",(0,a.kt)("inlineCode",{parentName:"li"},"ClusterConfiguration"),"\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u4e3a\u672c\u8282\u70b9\u5347\u7ea7 kubelet \u914d\u7f6e")),(0,a.kt)("h2",l({},{id:"\u5f15\u7528"}),"\u5f15\u7528"),(0,a.kt)("p",null,(0,a.kt)("a",l({parentName:"p"},{href:"https://v1-19.docs.kubernetes.io/zh/docs/setup/release/version-skew-policy/"}),"Kubernetes \u7248\u672c\u53ca\u7248\u672c\u504f\u5dee\u652f\u6301\u7b56\u7565 | Kubernetes")),(0,a.kt)("p",null,(0,a.kt)("a",l({parentName:"p"},{href:"https://v1-19.docs.kubernetes.io/zh/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/"}),"\u5347\u7ea7 kubeadm \u96c6\u7fa4 | Kubernetes")))}c.isMDXComponent=!0}}]);