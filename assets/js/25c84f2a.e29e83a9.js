"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6866],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>k});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c=a.createContext({}),i=function(e){var n=a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=i(e.components);return a.createElement(c.Provider,{value:n},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=i(t),d=r,k=m["".concat(c,".").concat(d)]||m[d]||u[d]||l;return t?a.createElement(k,o(o({ref:n},p),{},{components:t})):a.createElement(k,o({ref:n},p))}));function k(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,o=new Array(l);o[0]=d;var s={};for(var c in n)hasOwnProperty.call(n,c)&&(s[c]=n[c]);s.originalType=e,s[m]="string"==typeof e?e:r,o[1]=s;for(var i=2;i<l;i++)o[i]=t[i];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},7952:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>c,toc:()=>p});t(7294);var a=t(3905);function r(){return r=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},r.apply(this,arguments)}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}const o={},s=void 0,c={unversionedId:"kubernetes/storage/examples",id:"kubernetes/storage/examples",title:"examples",description:"pv : \u662f\u5bf9\u5e95\u5c42\u5b58\u50a8\u7684\u62bd\u8c61\uff0c\u5c06\u5b58\u50a8\u5b9a\u4e49\u4e3a\u4e00\u79cd\u201c\u8d44\u6e90\u201d",source:"@site/docs/kubernetes/storage/examples.md",sourceDirName:"kubernetes/storage",slug:"/kubernetes/storage/examples",permalink:"/docs/kubernetes/storage/examples",draft:!1,tags:[],version:"current",lastUpdatedAt:1675912862,formattedLastUpdatedAt:"2023\u5e742\u67089\u65e5",frontMatter:{},sidebar:"kubernetes",previous:{title:"\u6301\u4e45\u5377",permalink:"/docs/kubernetes/storage/persistent-volumes"}},i={},p=[{value:"\u9759\u6001\u4f9b\u5e94",id:"\u9759\u6001\u4f9b\u5e94",level:2},{value:"\u8bbf\u95ee\u6a21\u5f0f\uff1a",id:"\u8bbf\u95ee\u6a21\u5f0f",level:3},{value:"\u56de\u6536\u7b56\u7565",id:"\u56de\u6536\u7b56\u7565",level:3},{value:"\u52a8\u6001\u4f9b\u5e94",id:"\u52a8\u6001\u4f9b\u5e94",level:2},{value:"\u4f7f\u7528",id:"\u4f7f\u7528",level:2},{value:"TLS",id:"tls",level:2},{value:"\u4f7f\u7528",id:"\u4f7f\u7528-1",level:3},{value:"dockerconfigjson",id:"dockerconfigjson",level:2},{value:"\u4f7f\u7528",id:"\u4f7f\u7528-2",level:2}],m={toc:p},u="wrapper";function d(e){var{components:n}=e,t=l(e,["components"]);return(0,a.kt)(u,r({},m,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"pv")," : \u662f\u5bf9\u5e95\u5c42\u5b58\u50a8\u7684\u62bd\u8c61\uff0c\u5c06\u5b58\u50a8\u5b9a\u4e49\u4e3a\u4e00\u79cd\u201c\u8d44\u6e90\u201d"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"pvc"),": \u5ba2\u6237\u7aef\u5bf9\u5b58\u50a8\u8d44\u6e90\u7684\u4e00\u4e2a\u201c\u7533\u8bf7\u201d"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"storageclass"),"\uff1a \u5bf9\u5b58\u50a8\u7c7b\u578b\u7684\u62bd\u8c61\u5b9a\u4e49\uff0c\u7528\u4e8e\u6807\u8bb0\u5b58\u50a8\u8d44\u6e90\u7684\u7279\u6027\u548c\u6027\u80fd\uff0c localhost\u3001nfs \u3001ceph \u3002\u3002\u3002"),(0,a.kt)("h1",r({},{id:"\u6301\u4e45\u5316"}),"\u6301\u4e45\u5316"),(0,a.kt)("h2",r({},{id:"\u9759\u6001\u4f9b\u5e94"}),"\u9759\u6001\u4f9b\u5e94"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"pv")," \u662f\u7ba1\u7406\u5458\u521b\u5efa\u7684\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-yaml"}),'kind: PersistentVolume\napiVersion: v1\nmetadata:\n  name: localhost-pv\n  labels:\n    type: local\nspec:\n  storageClassName: localhostpath\n  capacity:\n    storage: 15Gi\n  accessModes:\n    - ReadWriteOnce\n  hostPath:\n    path: "/home/dragon/storage"\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: localhostpath-pvc\n  namespace: dragon\nspec:\n  volumeMode: Filesystem\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 8Gi\n  storageClassName: localhostpath\n')),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"pv ")," \u5173\u952e\u7684\u914d\u7f6e"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"1\u3001\u5b58\u50a8\u80fd\u529b\uff08Capacity\uff09")," "),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"2\u3001\u5b58\u50a8\u5377\u6a21\u5f0f\uff08Volume Mode\uff09")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"3\u3001\u8bbf\u95ee\u6a21\u5f0f\uff08Access Modes\uff09")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"4\u3001\u5b58\u50a8\u7c7b\u522b\uff08Class\uff09")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"5\u3001\u56de\u6536\u7b56\u7565\uff08Reclaim Policy\uff09"))),(0,a.kt)("h3",r({},{id:"\u8bbf\u95ee\u6a21\u5f0f"}),"\u8bbf\u95ee\u6a21\u5f0f\uff1a"),(0,a.kt)("p",null,"\u25ce ReadWriteOnce\uff08RWO\uff09\uff1a\u8bfb\u5199\u6743\u9650\uff0c\u5e76\u4e14\u53ea\u80fd\u88ab\u5355\u4e2aNode\u6302\u8f7d\u3002"),(0,a.kt)("p",null,"\u25ce ReadOnlyMany\uff08ROX\uff09\uff1a\u53ea\u8bfb\u6743\u9650\uff0c\u5141\u8bb8\u88ab\u591a\u4e2aNode\u6302\u8f7d\u3002"),(0,a.kt)("p",null,"\u25ce ReadWriteMany\uff08RWX\uff09\uff1a\u8bfb\u5199\u6743\u9650\uff0c\u5141\u8bb8\u88ab\u591a\u4e2aNode\u6302\u8f7d\u3002"),(0,a.kt)("h3",r({},{id:"\u56de\u6536\u7b56\u7565"}),"\u56de\u6536\u7b56\u7565"),(0,a.kt)("p",null,"\u901a\u8fc7 ",(0,a.kt)("strong",{parentName:"p"},"persistentVolumeReclaimPolicy")," \u5b57\u6bb5\u8bbe\u7f6e\uff0c"),(0,a.kt)("p",null,"\u25ce Retain \u4fdd\u7559\uff1a\u4fdd\u7559\u6570\u636e\uff0c\u9700\u8981\u624b\u5de5\u5904\u7406\u3002"),(0,a.kt)("p",null,"\u25ce Recycle \u56de\u6536\u7a7a\u95f4\uff1a\u7b80\u5355\u6e05\u9664\u6587\u4ef6\u7684\u64cd\u4f5c\uff08\u4f8b\u5982\u6267\u884crm -rf /thevolume/* \u547d\u4ee4\uff09\u3002"),(0,a.kt)("p",null,"\u25ce Delete \u5220\u9664\uff1a\u4e0ePV\u76f8\u8fde\u7684\u540e\u7aef\u5b58\u50a8\u5b8c\u6210Volume\u7684\u5220\u9664\u64cd\u4f5c"),(0,a.kt)("h2",r({},{id:"\u52a8\u6001\u4f9b\u5e94"}),"\u52a8\u6001\u4f9b\u5e94"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-yaml"}),"apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: localhostpath\n  namespace: dragon\nspec:\n  volumeMode: Filesystem\n  accessModes:\n    - ReadWriteMany\n  resources:\n    requests:\n      storage: 8Gi\n  storageClassName: localhostpath\n")),(0,a.kt)("h2",r({},{id:"\u4f7f\u7528"}),"\u4f7f\u7528"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-yaml"}),'kind: Pod\napiVersion: v1\nmetadata:\n  name: my-app\nspec:\n  containers:\n    - name: my-frontend\n      image: busybox\n      volumeMounts:\n      - mountPath: "/scratch"\n        name: scratch-volume\n      command: [ "sleep", "1000000" ]\n  volumes:\n    - name: scratch-volume\n      persistentVolumeClaim:\n        claimName: localhostpath\n\n')),(0,a.kt)("h1",r({},{id:"secret"}),"Secret"),(0,a.kt)("h2",r({},{id:"tls"}),"TLS"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-shell"}),"kubectl create secret tls ${secret_name} --namespace=${namespace} --key=${key} --cert=${cert}\n")),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-yaml"}),"apiVersion: v1\nkind: Secret\nmetadata:\n  name: secret-tls\n  namespace: dragon\ntype: kubernetes.io/tls\ndata:\n  tls.crt: |\n    <base64 encoded  >\n  tls.key: |\n    <base64 encoded  >\n\n")),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-yaml"}),'apiVersion: v1\nkind: Secret\nmetadata:\n  name: secret-tls\n  namespace: dragon\ntype: kubernetes.io/tls\nstringData:\n  tls.crt: |\n    "<raw string>"\n  tls.key: |\n    "<raw string>"\n')),(0,a.kt)("h3",r({},{id:"\u4f7f\u7528-1"}),"\u4f7f\u7528"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-yaml"}),"kind: Ingress\napiVersion: extensions/v1beta1\nmetadata:\n  name: web-console\n  namespace: anxincloud\n  annotations:\n    kubernetes.io/ingress.class: nginx\n    nginx.ingress.kubernetes.io/proxy-body-size: 50m\n    nginx.ingress.kubernetes.io/rewrite-target: /\n    nginx.org/redirect-to-https: 'true'\nspec:\n  tls:\n    - hosts:\n        - console.anxinyun.cn\n      secretName: anxincloud-root-secret\n  rules:\n    - host: console.anxinyun.cn\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              serviceName: web-console\n              servicePort: 9083\n")),(0,a.kt)("h2",r({},{id:"dockerconfigjson"}),"dockerconfigjson"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-yaml"}),'apiVersion: v1\nkind: Secret\nmetadata:\n  name: secret-dockercfg\ntype: kubernetes.io/dockercfg\ndata:\n  .dockercfg: |\n        "<base64 encoded ~/.dockercfg file>"\n')),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-yaml"}),'apiVersion: v1\nkind: Secret\nmetadata:\n  name: secret-dockercfg\ntype: kubernetes.io/dockercfg\nstringData:\n  .dockercfg: |\n    {\n      "auths": {\n              "https://registry.cn-hangzhou.aliyuncs.com": {\n              "username": "hi50040201@aliyun.com",\n              "password": "V9rtCnt$f",\n              "email": "huang.li@free-sun.com.cn",\n              "auth": "aGk1MDA0MDIwMUBhbGl5dW4uY29tOlY5cnRDbnQkZg=="\n          }\n      }\n    }\n\n')),(0,a.kt)("h2",r({},{id:"\u4f7f\u7528-2"}),"\u4f7f\u7528"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-yaml"}),"kind: Deployment\napiVersion: apps/v1\nmetadata:\n  name: api-anxincloud\n  namespace: anxincloud\n  labels:\n    app: api-anxincloud\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: api-anxincloud\n  template:\n    metadata:\n      labels:\n        app: api-anxincloud\n    spec:\n      containers:\n        - name: api-anxincloud\n          image: >-\n            registry.cn-hangzhou.aliyuncs.com/fs-cloud/anxinyun-web.api:179.21-12-15\n          command:\n            - node\n            - server.js\n          ports:\n            - name: http-8080\n              containerPort: 8080\n              protocol: TCP\n          envFrom:\n            - configMapRef:\n                name: cm-anxincloud\n          imagePullPolicy: IfNotPresent\n      restartPolicy: Always\n      nodeSelector:\n        app.type: web\n      imagePullSecrets:\n        - name: registry-secret\n\n")),(0,a.kt)("h1",r({},{id:"configmap"}),"ConfigMap"))}d.isMDXComponent=!0}}]);