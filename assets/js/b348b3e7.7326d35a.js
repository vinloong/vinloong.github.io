"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7220],{3905:(e,n,t)=>{t.d(n,{Zo:()=>s,kt:()=>k});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var o=a.createContext({}),d=function(e){var n=a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},s=function(e){var n=d(e.components);return a.createElement(o.Provider,{value:n},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),p=d(t),m=r,k=p["".concat(o,".").concat(m)]||p[m]||u[m]||l;return t?a.createElement(k,i(i({ref:n},s),{},{components:t})):a.createElement(k,i({ref:n},s))}));function k(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,i=new Array(l);i[0]=m;var c={};for(var o in n)hasOwnProperty.call(n,o)&&(c[o]=n[o]);c.originalType=e,c[p]="string"==typeof e?e:r,i[1]=c;for(var d=2;d<l;d++)i[d]=t[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},7486:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>s});t(7294);var a=t(3905);function r(){return r=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},r.apply(this,arguments)}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}const i={title:"containerd \u5165\u95e8",author:"Uncle Dragon",date:new Date("2021-06-16T00:00:00.000Z"),category:"k8s",tag:["k8s","containerd"]},c=void 0,o={unversionedId:"kubernetes/containers/containered",id:"kubernetes/containers/containered",title:"containerd \u5165\u95e8",description:"\u5b89\u88c5\u4e4b\u524d",source:"@site/docs/kubernetes/containers/containered.md",sourceDirName:"kubernetes/containers",slug:"/kubernetes/containers/containered",permalink:"/docs/kubernetes/containers/containered",draft:!1,tags:[],version:"current",lastUpdatedAt:1675912862,formattedLastUpdatedAt:"2023\u5e742\u67089\u65e5",frontMatter:{title:"containerd \u5165\u95e8",author:"Uncle Dragon",date:"2021-06-16T00:00:00.000Z",category:"k8s",tag:["k8s","containerd"]},sidebar:"kubernetes",previous:{title:"alpine-glibc",permalink:"/docs/kubernetes/containers/alpine-glibc"},next:{title:"cri-o \u5b89\u88c5",permalink:"/docs/kubernetes/containers/cri-o-start"}},d={},s=[{value:"\u5b89\u88c5\u4e4b\u524d",id:"\u5b89\u88c5\u4e4b\u524d",level:2},{value:"\u5b89\u88c5 containerd",id:"\u5b89\u88c5-containerd",level:2},{value:"1. \u4ece\u5b98\u65b9Docker\u4ed3\u5e93\u5b89\u88c5",id:"1-\u4ece\u5b98\u65b9docker\u4ed3\u5e93\u5b89\u88c5",level:3},{value:"2. \u4e0b\u8f7d containerd \u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u624b\u52a8\u5b89\u88c5",id:"2-\u4e0b\u8f7d-containerd-\u4e8c\u8fdb\u5236\u6587\u4ef6\u624b\u52a8\u5b89\u88c5",level:3},{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:2},{value:"\u914d\u7f6e\u5bb9\u5668\u955c\u50cf\u52a0\u901f",id:"\u914d\u7f6e\u5bb9\u5668\u955c\u50cf\u52a0\u901f",level:3},{value:"\u6d4b\u8bd5",id:"\u6d4b\u8bd5",level:2},{value:"\u4f7f\u7528",id:"\u4f7f\u7528",level:2},{value:"<code>ctr</code>",id:"ctr",level:3},{value:"<code>crictl</code>",id:"crictl",level:3},{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:3},{value:"\u4f7f\u7528",id:"\u4f7f\u7528-1",level:3},{value:"<code>nerdctl</code>",id:"nerdctl",level:3},{value:"\u5b89\u88c5",id:"\u5b89\u88c5-1",level:4},{value:"\u4f7f\u7528",id:"\u4f7f\u7528-2",level:3}],p={toc:s},u="wrapper";function m(e){var{components:n}=e,t=l(e,["components"]);return(0,a.kt)(u,r({},p,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",r({},{id:"\u5b89\u88c5\u4e4b\u524d"}),"\u5b89\u88c5\u4e4b\u524d"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-shell"}),"$ cat <<EOF | sudo tee /etc/modules-load.d/containerd.conf\noverlay\nbr_netfilter\nEOF\n\n$ sudo modprobe overlay\n$ sudo modprobe br_netfilter\n\n\n# \u8bbe\u7f6e\u5fc5\u9700\u7684 sysctl \u53c2\u6570\uff0c\u8fd9\u4e9b\u53c2\u6570\u5728\u91cd\u65b0\u542f\u52a8\u540e\u4ecd\u7136\u5b58\u5728\u3002\n$ cat <<EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf\nnet.bridge.bridge-nf-call-iptables  = 1\nnet.ipv4.ip_forward                 = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nEOF\n\n# \u5e94\u7528 sysctl \u53c2\u6570\u800c\u65e0\u9700\u91cd\u65b0\u542f\u52a8\n$ sudo sysctl --system\n")),(0,a.kt)("h2",r({},{id:"\u5b89\u88c5-containerd"}),"\u5b89\u88c5 containerd"),(0,a.kt)("h3",r({},{id:"1-\u4ece\u5b98\u65b9docker\u4ed3\u5e93\u5b89\u88c5"}),"1. \u4ece\u5b98\u65b9Docker\u4ed3\u5e93\u5b89\u88c5"),(0,a.kt)("p",null,"\u53c2\u8003 ",(0,a.kt)("a",r({parentName:"p"},{href:"https://docs.docker.com/engine/install/ubuntu/"}),"docker\u7684\u5b89\u88c5"),"\n\u4f60\u6ca1\u770b\u9519 \u5c31\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"docker")," \u7684\u5b89\u88c5\u6587\u6863\uff0c\u6211\u4eec\u53ea\u5b89\u88c5 ",(0,a.kt)("inlineCode",{parentName:"p"},"containerd.io")," \u5c31\u597d"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-shell"}),'$ sudo apt-get update\n\n$ sudo apt-get install \\\n    apt-transport-https \\\n    ca-certificates \\\n    curl \\\n    gnupg \\\n    lsb-release\n\n$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg\n\n$ echo \\\n  "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \\\n  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null\n\n\n$ sudo apt-get update\n\n$ sudo apt-get install containerd.io\n')),(0,a.kt)("h3",r({},{id:"2-\u4e0b\u8f7d-containerd-\u4e8c\u8fdb\u5236\u6587\u4ef6\u624b\u52a8\u5b89\u88c5"}),"2. \u4e0b\u8f7d containerd \u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u624b\u52a8\u5b89\u88c5"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-shell"}),"# \u4e0b\u8f7d\u94fe\u63a5\n$ wget https://github.com/containerd/containerd/releases/download/v1.5.4/cri-containerd-cni-1.5.4-linux-amd64.tar.gz\n\n# \u89e3\u538b\u4e8c\u8fdb\u5236\u5305\u5e76\u751f\u6210\u9ed8\u8ba4\u6587\u4ef6\n$ tar xvf containerd-1.5.2-linux-amd64.tar.gz -C /\n\n# \u521b\u5efa\u76ee\u5f55\n$ mkdir /etc/containerd\n\n# \u5728\u521b\u5efa\u7684\u76ee\u5f55\u4e2d\u751f\u6210\u914d\u7f6e\u6587\u4ef6\n$ containerd config default> /etc/containerd/config.toml\n")),(0,a.kt)("p",null,"\u914d\u7f6e ",(0,a.kt)("inlineCode",{parentName:"p"},"containerd")," \u670d\u52a1"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-shell"}),"$ sudo cat <<EOF | sudo tee /lib/systemd/system/containerd.service\n> [Unit]\n> Description=containerd container runtime\n> Documentation=https://containerd.io\n> After=network.target local-fs.target\n> \n> [Service]\n> ExecStartPre=-/sbin/modprobe overlay\n> ExecStart=/usr/local/bin/containerd\n> \n> Type=notify\n> Delegate=yes\n> KillMode=process\n> Restart=always\n> RestartSec=5\n>\n> LimitNPROC=infinity\n> LimitCORE=infinity\n> LimitNOFILE=1048576\n>\n> TasksMax=infinity\n> OOMScoreAdjust=-999\n> \n> [Install]\n> WantedBy=multi-user.target\n> EOF\n")),(0,a.kt)("p",null,"\u914d\u7f6e\u670d\u52a1\u5f00\u673a\u81ea\u542f"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-shell"}),"$ systemctl enable containerd \n\n$ systemctl start containerd \n\n$ systemctl status containerd\n")),(0,a.kt)("h2",r({},{id:"\u914d\u7f6e"}),"\u914d\u7f6e"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-shell"}),"$ sudo mkdir -p /etc/containerd\n$ containerd config default | sudo tee /etc/containerd/config.toml\n")),(0,a.kt)("p",null,"\u7ed3\u5408 ",(0,a.kt)("inlineCode",{parentName:"p"},"runc")," \u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"systemd")," cgroup \u9a71\u52a8\uff0c\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/containerd/config.toml")," \u4e2d\u8bbe\u7f6e"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{}),'[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]c\n  ...\n  [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]\n    SystemdCgroup = true\n')),(0,a.kt)("h3",r({},{id:"\u914d\u7f6e\u5bb9\u5668\u955c\u50cf\u52a0\u901f"}),"\u914d\u7f6e\u5bb9\u5668\u955c\u50cf\u52a0\u901f"),(0,a.kt)("p",null,"\u7f16\u8f91 ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/containerd/config.toml")),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{}),'    [plugins."io.containerd.grpc.v1.cri".registry]\n      [plugins."io.containerd.grpc.v1.cri".registry.mirrors]\n        [plugins."io.containerd.grpc.v1.cri".registry.mirrors."docker.io"]\n          endpoint = ["https://dr6tjot4.mirror.aliyuncs.com"]\n')),(0,a.kt)("p",null,"\u91cd\u65b0\u542f\u52a8 containerd"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-shell"}),"$ sudo systemctl restart containerd\n")),(0,a.kt)("h2",r({},{id:"\u6d4b\u8bd5"}),"\u6d4b\u8bd5"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-shell"}),"$ ctr version\nClient:\n  Version:  1.4.6\n  Revision: d71fcd7d8303cbf684402823e425e9dd2e99285d\n  Go version: go1.13.15\n\nServer:\n  Version:  1.4.6\n  Revision: d71fcd7d8303cbf684402823e425e9dd2e99285d\n  UUID: 2ba390eb-5ebf-49ae-a931-fa3ec68bb8aa\n")),(0,a.kt)("h2",r({},{id:"\u4f7f\u7528"}),"\u4f7f\u7528"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"ctr")," \u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"containerd")," \u81ea\u5e26\u7684\u5de5\u5177")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"crictl")," \u662f k8s \u793e\u533a\u5b9a\u4e49\u7684\u4e13\u95e8\u7684 CLI \u5de5\u5177")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"nerdctl")," \u662f containerd \u63a8\u51fa\u4e86\u4e00\u4e2a\u65b0\u7684 CLI \u5de5\u5177"))),(0,a.kt)("h3",r({},{id:"ctr"}),(0,a.kt)("inlineCode",{parentName:"h3"},"ctr")),(0,a.kt)("p",null,"\u8f93\u51fa\u7248\u672c\u4fe1\u606f"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-shell"}),"# ctr version\nClient:\n  Version:  1.4.6\n  Revision: d71fcd7d8303cbf684402823e425e9dd2e99285d\n  Go version: go1.13.15\n\nServer:\n  Version:  1.4.6\n  Revision: d71fcd7d8303cbf684402823e425e9dd2e99285d\n  UUID: 2ba390eb-5ebf-49ae-a931-fa3ec68bb8aa\n")),(0,a.kt)("p",null,"\u8f93\u51fa\u5e2e\u52a9\u4fe1\u606f"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-shell"}),'# ctr --help\nNAME:\n   ctr - \n        __\n  _____/ /______\n / ___/ __/ ___/\n/ /__/ /_/ /\n\\___/\\__/_/\n\ncontainerd CLI\n\n\nUSAGE:\n   ctr [global options] command [command options] [arguments...]\n\nVERSION:\n   1.4.6\n\nDESCRIPTION:\n\nctr is an unsupported debug and administrative client for interacting\nwith the containerd daemon. Because it is unsupported, the commands,\noptions, and operations are not guaranteed to be backward compatible or\nstable from release to release of the containerd project.\n\nCOMMANDS:\n   plugins, plugin            provides information about containerd plugins\n   version                    print the client and server versions\n   containers, c, container   manage containers\n   content                    manage content\n   events, event              display containerd events\n   images, image, i           manage images\n   leases                     manage leases\n   namespaces, namespace, ns  manage namespaces\n   pprof                      provide golang pprof outputs for containerd\n   run                        run a container\n   snapshots, snapshot        manage snapshots\n   tasks, t, task             manage tasks\n   install                    install a new package\n   oci                        OCI tools\n   shim                       interact with a shim directly\n   help, h                    Shows a list of commands or help for one command\n\nGLOBAL OPTIONS:\n   --debug                      enable debug output in logs\n   --address value, -a value    address for containerd\'s GRPC server (default: "/run/containerd/containerd.sock") [$CONTAINERD_ADDRESS]\n   --timeout value              total timeout for ctr commands (default: 0s)\n   --connect-timeout value      timeout for connecting to containerd (default: 0s)\n   --namespace value, -n value  namespace to use with commands (default: "default") [$CONTAINERD_NAMESPACE]\n   --help, -h                   show help\n   --version, -v                print the version\n')),(0,a.kt)("p",null,"\u62c9\u53d6\u955c\u50cf"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-shell"}),"# ctr images  pull docker.io/library/redis:latest\ndocker.io/library/redis:latest:                                                   resolved       |++++++++++++++++++++++++++++++++++++++| \nindex-sha256:7e2c6181ad5c425443b56c7c73a9cd6df24a122345847d1ea9bb86a5afc76325:    done           |++++++++++++++++++++++++++++++++++++++| \nmanifest-sha256:c2cbe8a592927bb74033f9c29b103ebc8e1ab3ed9598a9e937aaa2a723d5b8a7: done           |++++++++++++++++++++++++++++++++++++++| \nconfig-sha256:fad0ee7e917aeec77f15d0a106b8e415f4c0499d341b88c841b9a9f78c3c3ca5:   done           |++++++++++++++++++++++++++++++++++++++| \nlayer-sha256:fa57f005a60dc23920d7e5fa67ca618938a4b57254a773b174f0fd4950e02258:    done           |++++++++++++++++++++++++++++++++++++++| \nlayer-sha256:bcdf6fddc3bdaab696860eb0f4846895c53a3192c9d7bf8d2275770ea8073532:    done           |++++++++++++++++++++++++++++++++++++++| \nlayer-sha256:2902e41faefa618f0e57a9e63a2827e5024243af5933ca3e3af8cacb2e91d98b:    done           |++++++++++++++++++++++++++++++++++++++| \nlayer-sha256:69692152171afee1fd341febc390747cfca2ff302f2881d8b394e786af605696:    done           |++++++++++++++++++++++++++++++++++++++| \nlayer-sha256:df3e1d63cdb17d09cdccce0ee473223fc6981b524573359d620b31a022e42b0b:    done           |++++++++++++++++++++++++++++++++++++++| \nlayer-sha256:a4a46f2fd7e06fab84b4e78eb2d1b6d007351017f9b18dbeeef1a9e7cf194e00:    done           |++++++++++++++++++++++++++++++++++++++| \nelapsed: 17.3s                                                                    total:  36.9 M (2.1 MiB/s)                                       \nunpacking linux/amd64 sha256:7e2c6181ad5c425443b56c7c73a9cd6df24a122345847d1ea9bb86a5afc76325...\ndone\n")),(0,a.kt)("p",null,"\u67e5\u770b\u955c\u50cf\u6587\u4ef6\u5217\u8868"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{}),"# ctr images list\nREF                                              TYPE                                                      DIGEST                                                                  SIZE     PLATFORMS                                                                                               LABELS \ndocker.io/library/nginx:alpine                   application/vnd.docker.distribution.manifest.list.v2+json sha256:6d76a25a64f6a9a873bded796761bf7a1d18367570281d73d16750ce37fae297 9.4 MiB  linux/386,linux/amd64,linux/arm/v6,linux/arm/v7,linux/arm64/v8,linux/ppc64le,linux/s390x                -      \ndocker.io/library/redis:latest                   application/vnd.docker.distribution.manifest.list.v2+json sha256:7e2c6181ad5c425443b56c7c73a9cd6df24a122345847d1ea9bb86a5afc76325 36.9 MiB linux/386,linux/amd64,linux/arm/v5,linux/arm/v7,linux/arm64/v8,linux/mips64le,linux/ppc64le,linux/s390x -      \nrepository.anxinyun.cn/base-images/alpine:latest application/vnd.docker.distribution.manifest.v2+json      sha256:cc77c137c4e3fcaacb7f19f8b1582c0138f943dbbc27421060771ebb49e87a3a 7.2 MiB  linux/amd64                                                                                             -      \n")),(0,a.kt)("p",null,"\u8fd0\u884c\u548c\u67e5\u770b\u5bb9\u5668"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-shell"}),"# ctr run -d docker.io/library/redis:latest my-redis\n# ctr container list\nCONTAINER    IMAGE                             RUNTIME                  \nmy-nginx     docker.io/library/nginx:alpine    io.containerd.runc.v2    \nmy-redis     docker.io/library/redis:latest    io.containerd.runc.v2  \n")),(0,a.kt)("p",null,"\u5220\u9664\u5bb9\u5668"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-shell"}),"# ctr container list\nCONTAINER    IMAGE                             RUNTIME                  \nmy-nginx     docker.io/library/nginx:alpine    io.containerd.runc.v2    \nmy-redis     docker.io/library/redis:latest    io.containerd.runc.v2    \n# ctr task kill my-nginx\n\n# ctr container list\nCONTAINER    IMAGE                             RUNTIME                  \nmy-nginx     docker.io/library/nginx:alpine    io.containerd.runc.v2    \nmy-redis     docker.io/library/redis:latest    io.containerd.runc.v2    \n# ctr container del my-nginx\n\n# ctr container list\nCONTAINER    IMAGE                             RUNTIME                  \nmy-redis     docker.io/library/redis:latest    io.containerd.runc.v2\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"ctr \u6ca1\u6709 stop \u5bb9\u5668\u7684\u529f\u80fd\uff0c\u53ea\u80fd\u6682\u505c\u6216\u8005\u6740\u6b7b\u5bb9\u5668")),(0,a.kt)("h3",r({},{id:"crictl"}),(0,a.kt)("inlineCode",{parentName:"h3"},"crictl")),(0,a.kt)("h3",r({},{id:"\u5b89\u88c5"}),"\u5b89\u88c5"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4f7f\u7528 wget")),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-shell"}),'VERSION="v1.21.0"\nwget https://github.com/kubernetes-sigs/cri-tools/releases/download/$VERSION/crictl-$VERSION-linux-amd64.tar.gz\nsudo tar zxvf crictl-$VERSION-linux-amd64.tar.gz -C /usr/local/bin\nrm -f crictl-$VERSION-linux-amd64.tar.gz\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4f7f\u7528 curl")),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{}),'VERSION="v1.21.0"\ncurl -L https://github.com/kubernetes-sigs/cri-tools/releases/download/$VERSION/crictl-${VERSION}-linux-amd64.tar.gz --output crictl-${VERSION}-linux-amd64.tar.gz\nsudo tar zxvf crictl-$VERSION-linux-amd64.tar.gz -C /usr/local/bin\nrm -f crictl-$VERSION-linux-amd64.tar.gz\n')),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"crictl"),"\u9ed8\u8ba4\u8fde\u63a5\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"unix:///var/run/dockershim.sock")),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-shell"}),"$ sudo cat <<EOF | sudo tee /etc/crictl.yaml\n> runtime-endpoint: unix:///run/containerd/containerd.sock\n> image-endpoint: unix:///run/containerd/containerd.sock\n> timeout: 10\n> debug: false\n> EOF\n")),(0,a.kt)("h3",r({},{id:"\u4f7f\u7528-1"}),"\u4f7f\u7528"),(0,a.kt)("p",null,"\u8fd9\u4e2a\u662f\u4e3a\u4e86 k8s \u4f7f\u7528containerd \u800c\u505a\u7684\uff0c\u540e\u9762\u914d\u5408k8s \u518d\u505a\u5177\u4f53\u7684\u8bf4\u660e"),(0,a.kt)("p",null,"\u4e0b\u9762\u662fdocker \u548c containerd \u7684cli \u5de5\u5177\u4f7f\u7528\u5e38\u7528\u547d\u4ee4\u5bf9\u6bd4"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"id"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"docker"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"ctr"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"crictl"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"\u5907\u6ce8"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"1"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"docker images"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"ctr images ls"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"crictl images"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"\u67e5\u770b\u672c\u5730\u955c\u50cf")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"2"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"docker pull"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"ctr images pull"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"crictl pull"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"\u62c9\u53d6\u955c\u50cf")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"3"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"docker run"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"ctr container run"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"\u8fd0\u884c\u5bb9\u5668")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"4"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"docker ps"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"ctr task ls"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"crictl ps"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"\u67e5\u770b\u8fd0\u884c\u7684\u4eba\u5bb9\u5668")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"5"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"docker rm"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"ctr container del"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"crictl rm"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"\u79fb\u9664\u5bb9\u5668")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"6"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"docker exec"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"ctr task exec"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"crictl exec"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"\u8fdb\u5165\u5bb9\u5668")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"7"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"docker logs"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"crictl logs"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"\u67e5\u770b\u5bb9\u5668\u65e5\u5fd7")))),(0,a.kt)("h3",r({},{id:"nerdctl"}),(0,a.kt)("inlineCode",{parentName:"h3"},"nerdctl")),(0,a.kt)("h4",r({},{id:"\u5b89\u88c5-1"}),"\u5b89\u88c5"),(0,a.kt)("p",null,"\u4ed6\u6709\u4e24\u4e2a\u7248\u672c\uff0c\u4e00\u4e2afull \u7248\u7684\uff0c\u4e00\u4e2amini \u7248"),(0,a.kt)("p",null,"full \u7248\u672c\u5305\u542b\u4e86\u4f9d\u8d56\uff0c\u50cf containerd, runc, CNI \u7b49"),(0,a.kt)("p",null,"minimal : "),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-shell"}),"wget https://github.com/containerd/nerdctl/releases/download/v0.8.3/nerdctl-0.8.3-linux-amd64.tar.gz\ntar Cxzvvf /usr/local/bin nerdctl-0.8.3-linux-amd64.tar.gz\n")),(0,a.kt)("p",null,"full :"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-shell"}),"wget https://github.com/containerd/nerdctl/releases/download/v0.8.3/nerdctl-full-0.8.3-linux-amd64.tar.gz\ntar Cxzvvf /usr/local nerdctl-full-0.8.3-linux-amd64.tar.gz\n")),(0,a.kt)("p",null,"\u5982\u679c\u4e4b\u524d\u5b89\u88c5\u4e86container \u5c31\u53ef\u4ee5\u76f4\u63a5\u5b89\u88c5 minimal \u7248\u7684\u3002"),(0,a.kt)("h3",r({},{id:"\u4f7f\u7528-2"}),"\u4f7f\u7528"),(0,a.kt)("p",null,"\u4f7f\u7528\u4e0a\u57fa\u672c\u4e0e docker \u4e00\u81f4\uff0c\u628a ",(0,a.kt)("inlineCode",{parentName:"p"},"docker")," \u6362\u6210 ",(0,a.kt)("inlineCode",{parentName:"p"},"nerdctl")," \u547d\u4ee4\u57fa\u672c\u4e0a\u90fd\u53ef\u4ee5\u4f7f\u7528\uff0c"),(0,a.kt)("p",null,"\u4f46\u662f\u5982\u679c\u628a",(0,a.kt)("inlineCode",{parentName:"p"},"nerdctl")," \u7b80\u5355\u7684\u770b\u4f5c\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"docker")," cli \u7684\u590d\u5236\u5c31\u5927\u9519\u7279\u9519\u4e86\uff0c\u4ed6\u8fd8\u5b9e\u73b0\u4e86docker \u4e0d\u5177\u5907\u7684\u529f\u80fd\uff0c\u4f8b\u5982\u5ef6\u8fdf\u62c9\u53d6\u955c\u50cf\uff08",(0,a.kt)("a",r({parentName:"p"},{href:"https://github.com/containerd/nerdctl/blob/master/docs/stargz.md"}),"lazy-pulling"),"\uff09\u3001\u955c\u50cf\u52a0\u5bc6\uff08",(0,a.kt)("a",r({parentName:"p"},{href:"https://github.com/containerd/imgcrypt"}),"imgcrypt"),"\uff09\u7b49"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-shell"}),'# nerdctl ps\nCONTAINER ID    IMAGE                             COMMAND                   CREATED        STATUS    PORTS    NAMES\nmy-redis        docker.io/library/redis:latest    "docker-entrypoint.s\u2026"    4 hours ago    Up\n\n# nerdctl images\nREPOSITORY                                   TAG       IMAGE ID        CREATED        SIZE\nbusybox                                      latest    930490f97e5b    3 hours ago    1.3 MiB\nnginx                                        alpine    6d76a25a64f6    5 hours ago    16.0 KiB\nredis                                        latest    7e2c6181ad5c    5 hours ago    20.0 KiB\nrepository.anxinyun.cn/base-images/alpine    latest    cc77c137c4e3    3 days ago     5.3 MiB\n\n# nerdctl exec -it my-redis sh\n# \n')))}m.isMDXComponent=!0}}]);