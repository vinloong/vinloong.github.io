"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4085],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>k});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=r.createContext({}),p=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},u=function(e){var n=p(e.components);return r.createElement(s.Provider,{value:n},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=p(t),m=a,k=c["".concat(s,".").concat(m)]||c[m]||d[m]||o;return t?r.createElement(k,l(l({ref:n},u),{},{components:t})):r.createElement(k,l({ref:n},u))}));function k(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,l=new Array(o);l[0]=m;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i[c]="string"==typeof e?e:a,l[1]=i;for(var p=2;p<o;p++)l[p]=t[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},6032:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>s,toc:()=>u});t(7294);var r=t(3905);function a(){return a=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},a.apply(this,arguments)}function o(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}const l={},i=void 0,s={unversionedId:"kubernetes/kubebuilder/kubebuilder-quick-start",id:"kubernetes/kubebuilder/kubebuilder-quick-start",title:"kubebuilder-quick-start",description:"[TOC]",source:"@site/docs/kubernetes/kubebuilder/kubebuilder-quick-start.md",sourceDirName:"kubernetes/kubebuilder",slug:"/kubernetes/kubebuilder/kubebuilder-quick-start",permalink:"/docs/kubernetes/kubebuilder/kubebuilder-quick-start",draft:!1,tags:[],version:"current",lastUpdatedAt:1675912862,formattedLastUpdatedAt:"2023\u5e742\u67089\u65e5",frontMatter:{},sidebar:"kubernetes",previous:{title:"edge cloud",permalink:"/docs/kubernetes/kube-edge"},next:{title:"quick-start",permalink:"/docs/kubernetes/kubebuilder/quick-start"}},p={},u=[{value:"\u4e00\u4e2a\u57fa\u7840\u9879\u76ee\u91cc\u90fd\u6709\u4ec0\u4e48\uff1f",id:"\u4e00\u4e2a\u57fa\u7840\u9879\u76ee\u91cc\u90fd\u6709\u4ec0\u4e48",level:2},{value:"\u6784\u5efa\u57fa\u7840\u7ec4\u4ef6",id:"\u6784\u5efa\u57fa\u7840\u7ec4\u4ef6",level:3},{value:"\u542f\u52a8\u914d\u7f6e",id:"\u542f\u52a8\u914d\u7f6e",level:3},{value:"\u7a0b\u5e8f\u5165\u53e3",id:"\u7a0b\u5e8f\u5165\u53e3",level:3},{value:"\u4efb\u4f55\u4e00\u6bb5\u65c5\u7a0b\u90fd\u9700\u8981\u4e00\u4e2a\u8d77\u70b9\uff0c\u6bcf\u4e00\u4e2a\u7a0b\u5e8f\u90fd\u9700\u8981\u4e00\u4e2a\u5165\u53e3\u51fd\u6570",id:"\u4efb\u4f55\u4e00\u6bb5\u65c5\u7a0b\u90fd\u9700\u8981\u4e00\u4e2a\u8d77\u70b9\u6bcf\u4e00\u4e2a\u7a0b\u5e8f\u90fd\u9700\u8981\u4e00\u4e2a\u5165\u53e3\u51fd\u6570",level:3},{value:"\u7ec4\u548c\u7248\u672c",id:"\u7ec4\u548c\u7248\u672c",level:2},{value:"\u7c7b\u578b\u548c\u8d44\u6e90",id:"\u7c7b\u578b\u548c\u8d44\u6e90",level:2},{value:"Scheme \u662f\u4ec0\u4e48\uff1f",id:"scheme-\u662f\u4ec0\u4e48",level:2},{value:"\u5b89\u88c5 CR \u5b9e\u4f8b",id:"\u5b89\u88c5-cr-\u5b9e\u4f8b",level:2},{value:"\u5982\u4f55\u5728\u96c6\u7fa4\u4e2d\u8fd0\u884c",id:"\u5982\u4f55\u5728\u96c6\u7fa4\u4e2d\u8fd0\u884c",level:2}],c={toc:u},d="wrapper";function m(e){var{components:n}=e,t=o(e,["components"]);return(0,r.kt)(d,a({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"[TOC]"),(0,r.kt)("h1",a({},{id:"\u5b89\u88c5"}),"\u5b89\u88c5"),(0,r.kt)("p",null,"linux/mac "),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-shell"}),"\n\n# \u6211\u4f7f\u7528\u7684\u7248\u672c\u662f v3.1.0\nVERSION=v3.1.0\n\n# \u5230 https://github.com/kubernetes-sigs/kubebuilder/releases \u4e0b\u8f7d\u4e0e\u4f60\u64cd\u4f5c\u7cfb\u7edf\u5bf9\u5e94\u7684 kubebuilder \u5b89\u88c5\u5305\nwget https://github.com/kubernetes-sigs/kubebuilder/releases/download/$(VERSION)/kubebuilder_$(go env GOOS)_$(go env GOARCH) -O kubebuilder\n# \u6216\u4f7f\u7528\u4e0b\u9762\u547d\u4ee4\u4e0b\u8f7d\ncurl -L -o kubebuilder https://go.kubebuilder.io/dl/latest/$(go env GOOS)/$(go env GOARCH)\n\n# \u89e3\u538b\u5230 /usr/local/bin/\n# \u89e3\u538b\u5230\u8fd9\u91cc\u4e0d\u7528\u81ea\u5df1\u6dfb\u52a0\u73af\u5883\u53d8\u91cf\uff0c\u5982\u679c\u662f\u81ea\u5b9a\u4e49\u7684\u76ee\u5f55\uff0c\u8fd8\u9700\u8981\u5c06\u5176\u52a0\u5165\u5230\u73af\u5883\u53d8\u91cf path \u4e2d\nchmod +x kubebuilder && mv kubebuilder /usr/local/bin/\n\n")),(0,r.kt)("p",null,"windows "),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-cmd"}),"# windows \u4e0b\u6ca1\u6709\u5bf9\u5e94\u7684\u5b89\u88c5\u5305\uff0c\u9700\u8981\u81ea\u5df1\u628a\u4ee3\u7801\u4e0b\u4e0b\u6765\uff0c\u81ea\u5df1\u7f16\u8bd1\n# \u7531\u4e8ewindows \u7248\u672c\u6ca1\u6709\u811a\u672c\u5728\u521b\u5efaapi\u7684\u65f6\u5019\u4f1a\u62a5\u9519\uff0c\u6240\u4ee5\u5efa\u8bae\u8fd8\u662f\u4f7f\u7528linux \u7248\u672c\ngit clone git@github.com:kubernetes-sigs/kubebuilder\ncd kubebuilder\ngo build -o kubebuilder.exe ./cmd/\n\n\n")),(0,r.kt)("h1",a({},{id:"\u521b\u5efa\u4e00\u4e2a\u9879\u76ee"}),"\u521b\u5efa\u4e00\u4e2a\u9879\u76ee"),(0,r.kt)("p",null," \u521b\u5efa\u4e00\u4e2a\u76ee\u5f55\uff0c\u5728\u91cc\u9762\u6267\u884c ",(0,r.kt)("inlineCode",{parentName:"p"},"kubebuilder init")," \u547d\u4ee4\uff0c\u521d\u59cb\u5316\u4e00\u4e2a\u65b0\u9879\u76ee\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-shell"}),"\nmkdir -p ~/projects/guestbook\n\ncd ~/projects/guestbook\n\ngo mod init guestbook/m/v2\n\nkubebuilder init --domain my.domain --repo my.domain/guestbook\n\n#kubebuilder init --domain dragon.io\n\n")),(0,r.kt)("h2",a({},{id:"\u4e00\u4e2a\u57fa\u7840\u9879\u76ee\u91cc\u90fd\u6709\u4ec0\u4e48"}),"\u4e00\u4e2a\u57fa\u7840\u9879\u76ee\u91cc\u90fd\u6709\u4ec0\u4e48\uff1f"),(0,r.kt)("p",null,"\u5f53\u811a\u624b\u67b6\u4e3a\u6211\u4eec\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u65b0\u7684\u9879\u76ee\u65f6\uff0ckubebuilder \u4e3a\u6211\u4eec\u51c6\u5907\u597d\u4e86\u4e00\u4e9b\u57fa\u7840\u7684\u6a21\u677f\u6587\u4ef6\u3002"),(0,r.kt)("h3",a({},{id:"\u6784\u5efa\u57fa\u7840\u7ec4\u4ef6"}),"\u6784\u5efa\u57fa\u7840\u7ec4\u4ef6"),(0,r.kt)("p",null,"\u9996\u5148\u662f\u4e3a\u6784\u5efa\u51c6\u5907\u7684\u4e00\u4e9b\u57fa\u672c\u7684\u9879\u76ee\u6587\u4ef6"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"go.mod")," :   Go mod \u914d\u7f6e\u6587\u4ef6\uff0c\u8bb0\u5f55\u4f9d\u8d56\u5e93\u4fe1\u606f"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",a({parentName:"pre"},{className:"language-go"}),"module dragon.com/guestbook\n\ngo 1.16\n\nrequire (\n    github.com/onsi/ginkgo v1.14.1\n    github.com/onsi/gomega v1.10.2\n    k8s.io/apimachinery v0.20.2\n    k8s.io/client-go v0.20.2\n    sigs.k8s.io/controller-runtime v0.8.3\n)\n")))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Makefile"),": \u7528\u4e8e\u6784\u5efa\u548c\u90e8\u7f72\u4f60\u7684",(0,r.kt)("em",{parentName:"p"},"controller"),"\u7684 Makefile \u6587\u4ef6"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",a({parentName:"pre"},{className:"language-cmake"}),'\n# Image URL to use all building/pushing image targets\nIMG ?= controller:latest\n# Produce CRDs that work back to Kubernetes 1.11 (no version conversion)\nCRD_OPTIONS ?= "crd:trivialVersions=true,preserveUnknownFields=false"\n\n# Get the currently used golang install path (in GOPATH/bin, unless GOBIN is set)\nifeq (,$(shell go env GOBIN))\nGOBIN=$(shell go env GOPATH)/bin\nelse\nGOBIN=$(shell go env GOBIN)\nendif\n\n# Setting SHELL to bash allows bash commands to be executed by recipes.\n# This is a requirement for \'setup-envtest.sh\' in the test target.\n# Options are set to exit when a recipe line exits non-zero or a piped command fails.\nSHELL = /usr/bin/env bash -o pipefail\n.SHELLFLAGS = -ec\n\nall: build\n\n##@ General\n\n# The help target prints out all targets with their descriptions organized\n# beneath their categories. The categories are represented by \'##@\' and the\n# target descriptions by \'##\'. The awk commands is responsible for reading the\n# entire set of makefiles included in this invocation, looking for lines of the\n# file as xyz: ## something, and then pretty-format the target and help. Then,\n# if there\'s a line with ##@ something, that gets pretty-printed as a category.\n# More info on the usage of ANSI control characters for terminal formatting:\n# https://en.wikipedia.org/wiki/ANSI_escape_code#SGR_parameters\n# More info on the awk command:\n# http://linuxcommand.org/lc3_adv_awk.php\n\nhelp: ## Display this help.\n    @awk \'BEGIN {FS = ":.*##"; printf "\\nUsage:\\n  make \\033[36m<target>\\033[0m\\n"} /^[a-zA-Z_0-9-]+:.*?##/ { printf "  \\033[36m%-15s\\033[0m %s\\n", $$1, $$2 } /^##@/ { printf "\\n\\033[1m%s\\033[0m\\n", substr($$0, 5) } \' $(MAKEFILE_LIST)\n\n##@ Development\n\nmanifests: controller-gen ## Generate WebhookConfiguration, ClusterRole and CustomResourceDefinition objects.\n    $(CONTROLLER_GEN) $(CRD_OPTIONS) rbac:roleName=manager-role webhook paths="./..." output:crd:artifacts:config=config/crd/bases\n\ngenerate: controller-gen ## Generate code containing DeepCopy, DeepCopyInto, and DeepCopyObject method implementations.\n    $(CONTROLLER_GEN) object:headerFile="hack/boilerplate.go.txt" paths="./..."\n\nfmt: ## Run go fmt against code.\n    go fmt ./...\n\nvet: ## Run go vet against code.\n    go vet ./...\n\nENVTEST_ASSETS_DIR=$(shell pwd)/testbin\ntest: manifests generate fmt vet ## Run tests.\n    mkdir -p ${ENVTEST_ASSETS_DIR}\n    test -f ${ENVTEST_ASSETS_DIR}/setup-envtest.sh || curl -sSLo ${ENVTEST_ASSETS_DIR}/setup-envtest.sh https://raw.githubusercontent.com/kubernetes-sigs/controller-runtime/v0.8.3/hack/setup-envtest.sh\n    source ${ENVTEST_ASSETS_DIR}/setup-envtest.sh; fetch_envtest_tools $(ENVTEST_ASSETS_DIR); setup_envtest_env $(ENVTEST_ASSETS_DIR); go test ./... -coverprofile cover.out\n\n##@ Build\n\nbuild: generate fmt vet ## Build manager binary.\n    go build -o bin/manager main.go\n\nrun: manifests generate fmt vet ## Run a controller from your host.\n    go run ./main.go\n\ndocker-build: test ## Build docker image with the manager.\n    docker build -t ${IMG} .\n\ndocker-push: ## Push docker image with the manager.\n    docker push ${IMG}\n\n##@ Deployment\n\ninstall: manifests kustomize ## Install CRDs into the K8s cluster specified in ~/.kube/config.\n    $(KUSTOMIZE) build config/crd | kubectl apply -f -\n\nuninstall: manifests kustomize ## Uninstall CRDs from the K8s cluster specified in ~/.kube/config.\n    $(KUSTOMIZE) build config/crd | kubectl delete -f -\n\ndeploy: manifests kustomize ## Deploy controller to the K8s cluster specified in ~/.kube/config.\n    cd config/manager && $(KUSTOMIZE) edit set image controller=${IMG}\n    $(KUSTOMIZE) build config/default | kubectl apply -f -\n\nundeploy: ## Undeploy controller from the K8s cluster specified in ~/.kube/config.\n    $(KUSTOMIZE) build config/default | kubectl delete -f -\n\n\nCONTROLLER_GEN = $(shell pwd)/bin/controller-gen\ncontroller-gen: ## Download controller-gen locally if necessary.\n    $(call go-get-tool,$(CONTROLLER_GEN),sigs.k8s.io/controller-tools/cmd/controller-gen@v0.4.1)\n\nKUSTOMIZE = $(shell pwd)/bin/kustomize\nkustomize: ## Download kustomize locally if necessary.\n    $(call go-get-tool,$(KUSTOMIZE),sigs.k8s.io/kustomize/kustomize/v3@v3.8.7)\n\n# go-get-tool will \'go get\' any package $2 and install it to $1.\nPROJECT_DIR := $(shell dirname $(abspath $(lastword $(MAKEFILE_LIST))))\ndefine go-get-tool\n@[ -f $(1) ] || { \\\nset -e ;\\\nTMP_DIR=$$(mktemp -d) ;\\\ncd $$TMP_DIR ;\\\ngo mod init tmp ;\\\necho "Downloading $(2)" ;\\\nGOBIN=$(PROJECT_DIR)/bin go get $(2) ;\\\nrm -rf $$TMP_DIR ;\\\n}\nendef\n')))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"PROJECT"),":  \u7528\u4e8e\u751f\u6210\u7ec4\u4ef6\u7684 Kubebuilder \u5143\u6570\u636e"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",a({parentName:"pre"},{className:"language-yaml"}),'domain: dragon.com\nlayout:\n- go.kubebuilder.io/v3\nprojectName: guestbook\nrepo: dragon.com/guestbook\nresources:\n- api:\n    crdVersion: v1\n    namespaced: true\n  controller: true\n  domain: dragon.com\n  group: webapp\n  kind: Guestbook\n  path: dragon.com/guestbook/api/v1\n  version: v1\nversion: "3"\n\n')))),(0,r.kt)("h3",a({},{id:"\u542f\u52a8\u914d\u7f6e"}),"\u542f\u52a8\u914d\u7f6e"),(0,r.kt)("p",null,"\u6211\u4eec\u8fd8\u53ef\u4ee5\u5728 ",(0,r.kt)("em",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"em"},"config/"))," \u76ee\u5f55\u4e0b\u83b7\u5f97\u542f\u52a8\u914d\u7f6e\u3002\u73b0\u5728\uff0c\u5b83\u53ea\u5305\u542b\u4e86\u5728\u96c6\u7fa4\u4e0a\u542f\u52a8\u63a7\u5236\u5668\u6240\u9700\u7684 ",(0,r.kt)("em",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"em"},"Kustomize"))," YAML \u914d\u7f6e\u4e2d\u5b9a\u4e49\uff0c\u4f46\u4e00\u65e6\u6211\u4eec\u5f00\u59cb\u7f16\u5199\u63a7\u5236\u5668\uff0c\u5b83\u8fd8\u5c06\u5305\u542b\u6211\u4eec\u7684 CustomResourceDefinitions(CRD) \u3001RBAC \u914d\u7f6e\u548c WebhookConfigurations \u3002"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"em"},"config/default"))," \u4e2d\u5305\u542b",(0,r.kt)("inlineCode",{parentName:"p"}," Kustomize base"),"\u7528\u4e8e\u542f\u52a8",(0,r.kt)("inlineCode",{parentName:"p"},"controller")," \u7684\u4e00\u4e9b\u6807\u51c6\u914d\u7f6e\u3002"),(0,r.kt)("p",null,"\u5176\u4ed6\u6bcf\u4e2a\u76ee\u5f55\u90fd\u5305\u542b\u4e00\u4e2a\u4e0d\u540c\u7684\u914d\u7f6e\uff0c\u91cd\u6784\u4e3a\u81ea\u5df1\u7684\u57fa\u7840\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"em"},"config/manager")),": \u5728\u96c6\u7fa4\u4e2d\u4ee5 pod \u7684\u5f62\u5f0f\u542f\u52a8",(0,r.kt)("inlineCode",{parentName:"li"},"controller")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"em"},"config/rbac")),": \u5728\u81ea\u5df1\u7684\u8d26\u6237\u4e0b\u8fd0\u884c",(0,r.kt)("inlineCode",{parentName:"li"},"controller"),"\u6240\u9700\u7684\u6743\u9650")),(0,r.kt)("h3",a({},{id:"\u7a0b\u5e8f\u5165\u53e3"}),"\u7a0b\u5e8f\u5165\u53e3"),(0,r.kt)("p",null,"\u6700\u540e\uff0c\u6700\u91cd\u8981\u7684\u4e00\u70b9\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"kubebuilder")," \u751f\u6210\u4e00\u4e2a\u9879\u76ee\u7a0b\u5e8f\u5165\u53e3: ",(0,r.kt)("inlineCode",{parentName:"p"},"main.go"),"\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u6765\u770b\u770b\u5b83\u3002\u3002\u3002"),(0,r.kt)("h3",a({},{id:"\u4efb\u4f55\u4e00\u6bb5\u65c5\u7a0b\u90fd\u9700\u8981\u4e00\u4e2a\u8d77\u70b9\u6bcf\u4e00\u4e2a\u7a0b\u5e8f\u90fd\u9700\u8981\u4e00\u4e2a\u5165\u53e3\u51fd\u6570"}),"\u4efb\u4f55\u4e00\u6bb5\u65c5\u7a0b\u90fd\u9700\u8981\u4e00\u4e2a\u8d77\u70b9\uff0c\u6bcf\u4e00\u4e2a\u7a0b\u5e8f\u90fd\u9700\u8981\u4e00\u4e2a\u5165\u53e3\u51fd\u6570"),(0,r.kt)("p",null,"main \u6587\u4ef6\u5f00\u59cb\u662f import \u4e00\u4e9b\u57fa\u672c\u5e93, \u5c24\u5176\u662f"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6838\u5fc3\u63a7\u5236\u5668\u8fd0\u884c\u65f6\u5e93"),(0,r.kt)("li",{parentName:"ul"},"\u9ed8\u8ba4\u7684\u63a7\u5236\u5668\u8fd0\u884c\u65f6\u65e5\u5fd7\u5e93 --- zap")),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-go"}),'import (\n    webappv1 "dragon.com/guestbook/api/v1"\n    "dragon.com/guestbook/controllers"\n    "flag"\n    "k8s.io/apimachinery/pkg/runtime"\n    utilruntime "k8s.io/apimachinery/pkg/util/runtime"\n    clientgoscheme "k8s.io/client-go/kubernetes/scheme"\n    _ "k8s.io/client-go/plugin/pkg/client/auth"\n    "os"\n    ctrl "sigs.k8s.io/controller-runtime"\n    "sigs.k8s.io/controller-runtime/pkg/healthz"\n    "sigs.k8s.io/controller-runtime/pkg/log/zap"\n    //+kubebuilder:scaffold:imports\n)\n')),(0,r.kt)("p",null,"\u6bcf\u4e00\u7ec4\u63a7\u5236\u5668\u90fd\u9700\u8981\u4e00\u4e2a ",(0,r.kt)("em",{parentName:"p"},"Scheme"),"\uff0c\u5b83\u63d0\u4f9b\u4e86 Kinds \u548c\u76f8\u5e94\u7684 Go \u7c7b\u578b\u4e4b\u95f4\u7684\u6620\u5c04\u3002\u6211\u4eec\u5c06\u5728\u7f16\u5199 API \u5b9a\u4e49\u7684\u65f6\u5019\u518d\u8c08\u4e00\u8c08 Kinds\uff0c\u6240\u4ee5\u73b0\u5728\u53ea\u9700\u8981\u8bb0\u4f4f\u5b83\u5c31\u597d\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-go"}),'var (\n    scheme   = runtime.NewScheme()\n    setupLog = ctrl.Log.WithName("setup")\n)\n\nfunc init() {\n    utilruntime.Must(clientgoscheme.AddToScheme(scheme))\n\n    utilruntime.Must(webappv1.AddToScheme(scheme))\n    //+kubebuilder:scaffold:scheme\n}\n')),(0,r.kt)("p",null,"\u8fd9\u6bb5\u4ee3\u7801\u7684\u6838\u5fc3\u903b\u8f91\u6bd4\u8f83\u7b80\u5355\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6211\u4eec\u901a\u8fc7 flag \u5e93\u89e3\u6790\u5165\u53c2"),(0,r.kt)("li",{parentName:"ul"},"\u6211\u4eec\u5b9e\u4f8b\u5316\u4e00\u4e2a manager ,\u5b83\u8bb0\u5f55\u4e86\u6211\u4eec\u6240\u6709\u63a7\u5236\u5668\u7684\u8fd0\u884c\u60c5\u51b5\uff0c\u4ee5\u53ca\u8bbe\u7f6e\u5171\u4eab\u7f13\u5b58\u548cAPI \u670d\u52a1\u5668\u7684\u5ba2\u6237\u7aef\uff0c\uff08\u6ce8\u610f\uff0c\u6211\u4eec\u628a\u6211\u4eec\u7684 Scheme \u7684\u4fe1\u606f\u544a\u8bc9\u4e86 manager\uff09"),(0,r.kt)("li",{parentName:"ul"},"\u8fd0\u884c manager \uff0c\u5b83\u53cd\u8fc7\u6765\u8fd0\u884c\u6211\u4eec\u6240\u6709\u7684\u63a7\u5236\u5668\u548c webhooks \u3002mangager \u72b6\u6001\u88ab\u8bbe\u7f6e\u4e3a Runing \uff0c\u76f4\u5230\u5b83\u6536\u5230\u4e00\u4e2a\u4f18\u96c5\u7684\u505c\u673a\u4fe1\u53f7\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u5728k8s \u4e0a\u8fd0\u884c\u65f6app\u65f6\uff0c\u53ef\u4ee5\u4f18\u96c5\u7684\u505c\u6b62pod.")),(0,r.kt)("p",null,"\u73b0\u5728\u6211\u4eec\u8fd8\u6ca1\u8fd0\u884c\u4efb\u4f55\u4ee3\u7801\uff0c\u4f46\u662f\u8bf7\u8bb0\u4f4f\u8fd9\u4e2a\u6ce8\u91ca ",(0,r.kt)("inlineCode",{parentName:"p"},"//+kubebuilder:scaffold:scheme")),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-go"}),'func main() {\n    var metricsAddr string\n    var enableLeaderElection bool\n    var probeAddr string\n    flag.StringVar(&metricsAddr, "metrics-bind-address", ":8080", "The address the metric endpoint binds to.")\n    flag.StringVar(&probeAddr, "health-probe-bind-address", ":8081", "The address the probe endpoint binds to.")\n    flag.BoolVar(&enableLeaderElection, "leader-elect", false,\n        "Enable leader election for controller manager. "+\n            "Enabling this will ensure there is only one active controller manager.")\n    opts := zap.Options{\n        Development: true,\n    }\n    opts.BindFlags(flag.CommandLine)\n    flag.Parse()\n\n    ctrl.SetLogger(zap.New(zap.UseFlagOptions(&opts)))\n\n    mgr, err := ctrl.NewManager(ctrl.GetConfigOrDie(), ctrl.Options{\n        Scheme:                 scheme,\n        MetricsBindAddress:     metricsAddr,\n        Port:                   9443,\n        HealthProbeBindAddress: probeAddr,\n        LeaderElection:         enableLeaderElection,\n        LeaderElectionID:       "bcb35137.dragon.com",\n    })\n    if err != nil {\n        setupLog.Error(err, "unable to start manager")\n        os.Exit(1)\n    }\n\n    if err = (&controllers.GuestbookReconciler{\n        Client: mgr.GetClient(),\n        Scheme: mgr.GetScheme(),\n    }).SetupWithManager(mgr); err != nil {\n        setupLog.Error(err, "unable to create controller", "controller", "Guestbook")\n        os.Exit(1)\n    }\n    //+kubebuilder:scaffold:builder\n\n    if err := mgr.AddHealthzCheck("healthz", healthz.Ping); err != nil {\n        setupLog.Error(err, "unable to set up health check")\n        os.Exit(1)\n    }\n    if err := mgr.AddReadyzCheck("readyz", healthz.Ping); err != nil {\n        setupLog.Error(err, "unable to set up ready check")\n        os.Exit(1)\n    }\n\n    setupLog.Info("starting manager")\n    if err := mgr.Start(ctrl.SetupSignalHandler()); err != nil {\n        setupLog.Error(err, "problem running manager")\n        os.Exit(1)\n    }\n}\n')),(0,r.kt)("p",null,"\u6ce8\u610f\uff1aManager \u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u9650\u5236\u63a7\u5236\u5668\u53ef\u4ee5\u76d1\u542c\u8d44\u6e90\u7684\u547d\u540d\u7a7a\u95f4\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-go"}),'    mgr, err := ctrl.NewManager(ctrl.GetConfigOrDie(), ctrl.Options{\n        Scheme:                 scheme,\n        Namespace:          namespace,\n        MetricsBindAddress:     metricsAddr,\n        Port:                   9443,\n        HealthProbeBindAddress: probeAddr,\n        LeaderElection:         enableLeaderElection,\n        LeaderElectionID:       "bcb35137.dragon.com",\n    })\n')),(0,r.kt)("p",null,"\u4e0a\u9762\u7684\u6817\u5b50\u628a\u4f60\u7684\u9879\u76ee\u6539\u6210\u4e86\u53ea\u76d1\u542c\u5355\u4e00\u547d\u540d\u7a7a\u95f4\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5efa\u8bae\u901a\u8fc7\u9ed8\u8ba4\u7684 ClusterRole \u548c ClusterRoleBinding \u5206\u522b\u66ff\u6362\u4e3a Role \u548c RoleBinding \u6765\u9650\u5236\u6240\u63d0\u4f9b\u7ed9\u8fd9\u4e2a\u547d\u540d\u7a7a\u95f4\u7684\u6388\u6743\u3002"),(0,r.kt)("p",null,"\u53e6\u5916\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 MultiNamespacedCacheBuilder \u6765\u76d1\u542c\u7279\u5b9a\u7684\u547d\u540d\u7a7a\u95f4\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-go"}),'   var namespaces []string // List of Namespaces\n\n    mgr, err = ctrl.NewManager(ctrl.GetConfigOrDie(), ctrl.Options{\n        Scheme:             scheme,\n        NewCache:           cache.MultiNamespacedCacheBuilder(namespaces),\n        MetricsBindAddress: fmt.Sprintf("%s:%d", metricsHost, metricsPort),\n    })\n')),(0,r.kt)("p",null,"\u8bf4\u5b8c\u8fd9\u4e9b\uff0c\u6211\u4eec\u53ef\u4ee5\u5f00\u59cb\u521b\u5efa\u6211\u4eec\u7684 API \u4e86\u3002"),(0,r.kt)("h1",a({},{id:"gvk-\u4ecb\u7ecd"}),"GVK \u4ecb\u7ecd"),(0,r.kt)("p",null,"\u5728\u6211\u4eec\u5f00\u59cb\u8bf4 API \u4e4b\u524d\uff0c\u6211\u4eec\u5e94\u8be5\u5148\u4ecb\u7ecd\u4e0b k8s \u4e2d API \u7684\u76f8\u5173\u672f\u8bed"),(0,r.kt)("p",null,"\u6211\u4eec\u5728\u8c08\u8bba k8s \u7684API \u6211\u4eec\u7ecf\u5e38\u4f1a\u63d0\u5230 \u4e0b\u97624\u4e2a\u672f\u8bed\uff1a groups \u3001versions \u3001kinds \u548c resources \u3002"),(0,r.kt)("h2",a({},{id:"\u7ec4\u548c\u7248\u672c"}),"\u7ec4\u548c\u7248\u672c"),(0,r.kt)("p",null,"k8s \u4e2d\u7684API \u7ec4\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u76f8\u5173\u529f\u80fd\u7684\u96c6\u5408\u3002\u6bcf\u4e2a\u7ec4\u90fd\u6709\u4e00\u4e2a\u6216\u591a\u4e2a\u7248\u672c\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5b83\u5141\u8bb8\u6211\u4eec\u968f\u8fd9\u65f6\u95f4\u7684\u63a8\u79fb\u6539\u53d8 API \u7684\u804c\u8d23\u3002"),(0,r.kt)("h2",a({},{id:"\u7c7b\u578b\u548c\u8d44\u6e90"}),"\u7c7b\u578b\u548c\u8d44\u6e90"),(0,r.kt)("p",null,"\u6bcf\u4e2aAPI \u7ec4-\u7248\u672c\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2aAPI \u7c7b\u578b\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a Kinds\u3002 \u867d\u7136\u4e00\u4e2a Kind \u53ef\u4ee5\u5728\u4e0d\u540c\u7248\u672c\u4e4b\u95f4\u6539\u53d8\u8868\u5355\u5185\u5bb9, \u4f46\u6bcf\u4e2a\u8868\u5355\u5fc5\u987b\u80fd\u591f\u4ee5\u67d0\u79cd\u65b9\u5f0f\u5b58\u50a8\u5176\u4ed6\u8868\u5355\u7684\u6240\u6709\u6570\u636e(\u6211\u4eec\u53ef\u4ee5\u628a\u6570\u636e\u5b58\u50a8\u5728\u5b57\u6bb5\u4e2d\u6216\u8005\u5728\u6ce8\u91ca\u4e2d)\u3002\u8fd9\u6837\u5728\u4f7f\u7528\u65e7\u7248\u7684API \u7248\u672c\u4e0d\u4f1a\u5bfc\u81f4\u65b0\u7684\u6570\u636e\u4e22\u5931\u6216\u635f\u5931\u3002"),(0,r.kt)("p",null,"\u4f60\u4e5f\u4f1a\u5076\u5c14\u542c\u5230 ",(0,r.kt)("inlineCode",{parentName:"p"},"resources"),"\u3002 ",(0,r.kt)("inlineCode",{parentName:"p"},"resources")," (\u8d44\u6e90) \u53ea\u662fAPI \u4e2d\u7684\u4e00\u4e2akind \u7684\u4f7f\u7528\u65b9\u5f0f\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0cKind \u548c resource \u4e4b\u95f4\u6709\u4e00\u4e2a\u4e00\u5bf9\u4e00\u7684\u6620\u5c04\u3002\u4f8b\u5982\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"pods")," \u8d44\u6e90\u5bf9\u5e94\u4e8e ",(0,r.kt)("inlineCode",{parentName:"p"},"Pod")," \u79cd\u7c7b\u3002\u4f46\u662f\u6709\u65f6\uff0c\u540c\u4e00\u7c7b\u578b\u53ef\u80fd\u7531\u591a\u4e2a\u8d44\u6e90\u8fd4\u56de\u3002\u4f8b\u5982\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"Scale")," Kind \u662f\u7531\u6240\u6709 ",(0,r.kt)("inlineCode",{parentName:"p"},"scale")," \u5b50\u8d44\u6e90\u8fd4\u56de\u7684\uff0c\u5982 ",(0,r.kt)("inlineCode",{parentName:"p"},"deployments/scale")," \u6216 ",(0,r.kt)("inlineCode",{parentName:"p"},"replicasets/scale"),"\u3002\u8fd9\u5c31\u662f\u5141\u8bb8 Kubernetes HorizontalPodAutoscaler(HPA) \u4e0e\u4e0d\u540c\u8d44\u6e90\u4ea4\u4e92\u7684\u539f\u56e0\u3002\u7136\u800c\uff0c\u4f7f\u7528 CRD\uff0c\u6bcf\u4e2a Kind \u90fd\u5c06\u5bf9\u5e94\u4e00\u4e2a resources\u3002"),(0,r.kt)("p",null,"\u6ce8\u610f\uff1aresource \u603b\u662f\u5c0f\u5199\uff0c\u6309\u7167\u60ef\u4f8b\u662f kind \u7684\u5c0f\u5199\u5f62\u5f0f\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{}),"GVK = Group Version Kind GVR = Group Version Resources\n")),(0,r.kt)("p",null,"\u5f53\u6211\u4eec\u5728\u4e00\u4e2a\u7279\u5b9a\u7684\u7fa4\u7ec4\u7248\u672c (Group-Version) \u4e2d\u63d0\u5230\u4e00\u4e2a Kind \u65f6\uff0c\u6211\u4eec\u4f1a\u628a\u5b83\u79f0\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"GroupVersionKind"),"\uff0c\u7b80\u79f0 GVK\u3002\u4e0e \u8d44\u6e90 (resources) \u548c GVR \u4e00\u6837\uff0c\u6211\u4eec\u5f88\u5feb\u5c31\u4f1a\u770b\u5230\uff0c\u6bcf\u4e2a GVK \u5bf9\u5e94 Golang \u4ee3\u7801\u4e2d\u7684\u5230\u5bf9\u5e94\u751f\u6210\u4ee3\u7801\u4e2d\u7684 Go type\u3002"),(0,r.kt)("p",null,"\u73b0\u5728\u6211\u4eec\u7406\u89e3\u4e86\u8fd9\u4e9b\u672f\u8bed\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5",(0,r.kt)("strong",{parentName:"p"},"\u771f\u6b63"),"\u5730\u521b\u5efa\u6211\u4eec\u7684 API\uff01"),(0,r.kt)("h2",a({},{id:"scheme-\u662f\u4ec0\u4e48"}),"Scheme \u662f\u4ec0\u4e48\uff1f"),(0,r.kt)("p",null,"\u6211\u4eec\u4e4b\u524d\u770b\u5230\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"Scheme")," \u662f\u4e00\u79cd\u8ffd\u8e2a Go Type \u7684\u65b9\u6cd5\uff0c\u5b83\u5bf9\u5e94\u4e8e\u7ed9\u5b9a\u7684GVK."),(0,r.kt)("p",null,"\u4f8b\u5982\uff0c\u5047\u5982\u6211\u4eec\u5c06 ",(0,r.kt)("inlineCode",{parentName:"p"},'"tutorial.kubebuilder.io/api/v1".Guestbook{}')," \u7c7b\u578b\u653e\u7f6e\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"batch.tutorial.kubebuilder.io/v1")," API \u7ec4\u4e2d\uff08\u4e5f\u5c31\u662f\u8bf4\u5b83\u6709 ",(0,r.kt)("inlineCode",{parentName:"p"},"Guestbook")," Kind)\u3002"),(0,r.kt)("p",null,"\u7136\u540e\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5\u5728 API server \u7ed9\u5b9a\u7684 json \u6570\u636e\u6784\u9020\u4e00\u4e2a\u65b0\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"&Guestbook{}"),"\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-go"}),'{\n    "kind": "Guestbook",\n    "apiVersion": "batch.tutorial.kubebuilder.io/v1",\n    ...\n}\n')),(0,r.kt)("p",null,"\u6216\u5f53\u6211\u4eec\u5728\u4e00\u6b21\u53d8\u66f4\u4e2d\u53bb\u66f4\u65b0\u6216\u63d0\u4ea4 ",(0,r.kt)("inlineCode",{parentName:"p"},"&Guestbook{}")," \u65f6\uff0c\u67e5\u627e\u6b63\u786e\u7684\u7ec4\u7248\u672c"),(0,r.kt)("h1",a({},{id:"\u521b\u5efa\u4e00\u4e2aapi"}),"\u521b\u5efa\u4e00\u4e2aAPI"),(0,r.kt)("p",null,"\u642d\u5efa\u4e00\u4e2a\u65b0\u7684 kind ,\u548c\u76f8\u5e94\u7684\u63a7\u5236\u5668\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684API  ,\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528kubebuilder create api :"),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-shell"})," kubebuilder create api --group webapp --version v1 --kind Guestbook\n")),(0,r.kt)("p",null,"\u5f53\u6211\u4eec\u7b2c\u4e00\u6b21\u4e3a\u6bcf\u4e2a\u7ec4-\u7248\u672c\u4f7f\u7528\u8fd9\u4e2a\u547d\u4ee4\u7684\u65f6\u5019\uff0c\u5b83\u4f1a\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7ec4-\u7248\u672c\u76ee\u5f55\u3002"),(0,r.kt)("p",null,"\u672c\u6848\u4f8b\u4e2d\u521b\u5efa\u4e86\u4e00\u4e2a\u5bf9\u5e94 ",(0,r.kt)("inlineCode",{parentName:"p"},"dragon.com/v1"),"\u7684\u76ee\u5f55 ",(0,r.kt)("inlineCode",{parentName:"p"},"api/v1")),(0,r.kt)("p",null,"\u5b83\u4e5f\u4e3a\u6211\u4eec\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"Guestbook")," Kind \u6dfb\u52a0\u4e86\u4e00\u4e2a\u6587\u4ef6, ",(0,r.kt)("inlineCode",{parentName:"p"},"api/v1/guestbook_types.go"),"\u3002\u6bcf\u6b21\u6211\u4eec\u7528\u4e0d\u540c\u7684 kind \u53bb\u8c03\u7528\u8fd9\u4e2a\u547d\u4ee4\uff0c\u5b83\u5c06\u6dfb\u52a0\u4e00\u4e2a\u76f8\u5e94\u7684\u65b0\u6587\u4ef6\u3002"),(0,r.kt)("p",null,"\u6211\u4eec\u6765\u770b\u4e0b\u6709\u54ea\u4e9b\u4e1c\u897f\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-shell"}),"vi guestbook_types.go\n")),(0,r.kt)("p",null,"\u5bfc\u5165 meta/v1 API \u7ec4,\u901a\u5e38\u672c\u8eab\u5e76\u4e0d\u4f1a\u66b4\u9732\u8be5\u7ec4\uff0c\u800c\u662f\u5305\u542b\u6240\u6709 k8s \u79cd\u7c7b\u5171\u6709\u7684\u5143\u6570\u636e\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-go"}),'import (\n    metav1 "k8s.io/apimachinery/pkg/apis/meta/v1"\n)\n')),(0,r.kt)("p",null,"\u4e0b\u9762\uff0c\u6211\u4eec\u4e3a\u79cd\u7c7b\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"Spec"),"  \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"Status")," \u5b9a\u4e49\u7c7b\u578b\u3002 k8s \u529f\u80fd\u901a\u8fc7\u4f7f\u671f\u5f85\u7684\u72b6\u6001 (Spec) \u548c\u5b9e\u9645\u96c6\u7fa4\u72b6\u6001(\u5176\u4ed6\u5bf9\u8c61\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"Status")," )\u4fdd\u6301\u4e00\u81f4\u548c\u5916\u90e8\u72b6\u6001\uff0c\u7136\u540e\u8bb0\u5f55\u89c2\u5bdf\u5230\u7684\u72b6\u6001(Status)\u3002 \u56e0\u6b64\uff0c\u6bcf\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"functional")," \u5bf9\u8c61\u5305\u62ec ",(0,r.kt)("inlineCode",{parentName:"p"},"spec")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"status")," \u3002 \u5f88\u5c11\u7684\u7c7b\u578b\uff0c\u50cf ",(0,r.kt)("inlineCode",{parentName:"p"},"ConfiMap")," \u4e0d\u9700\u8981\u9075\u4ece\u8fd9\u4e2a\u6a21\u5f0f\uff0c\u56e0\u6b64\u5b83\u4eec\u4e0d\u7f16\u7801\u671f\u5f85\u7684\u72b6\u6001\uff0c\u4f46\u662f\u5927\u90e8\u5206\u7c7b\u578b\u9700\u8981\u505a\u8fd9\u4e00\u6b65\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-go"}),'// \u7f16\u8f91\u8fd9\u4e2a\u6587\u4ef6\uff01\u8fd9\u4e2a\u662f\u4f60\u62e5\u6709\u7684\u811a\u624b\u67b6\n// \u6ce8\u610f\u7684\u662f\uff1ajson \u6807\u7b7e\u662f\u5fc5\u9700\u7684.\u4e3a\u4e86\u80fd\u591f\u5e8f\u5217\u5316\u5b57\u6bb5\uff0c\u4efb\u4f55\u4f60\u6dfb\u52a0\u7684\u65b0\u5b57\u6bb5\u4e00\u5b9a\u8981\u6709 json \u6807\u7b7e\u3002\n\n// GuestbookSpec defines the desired state of Guestbook\ntype GuestbookSpec struct {\n    // INSERT ADDITIONAL SPEC FIELDS - desired state of cluster\n    // Important: Run "make" to regenerate code after modifying this file\n\n    // Foo is an example field of Guestbook. Edit guestbook_types.go to remove/update\n    Foo string `json:"foo,omitempty"`\n    metav1.TypeMeta `json:",inline"`\n    metav1.ObjectMeta `json:"metadata,omitempty"`\n\n    Spec v1beta1.CronJobSpec    `json:"spec,omitempty"`\n    Status v1beta1.CronJobStatus    `json:"status,omitempty"`\n}\n\n// GuestbookStatus defines the observed state of Guestbook\ntype GuestbookStatus struct {\n    // INSERT ADDITIONAL STATUS FIELD - define observed state of cluster\n    // Important: Run "make" to regenerate code after modifying this file\n\n}\n')),(0,r.kt)("p",null,"\u4e0b\u4e00\u6b65\uff0c\u6211\u4eec\u5b9a\u4e49\u4e0e\u5b9e\u9645\u79cd\u7c7b\u76f8\u5bf9\u5e94\u7684\u7c7b\u578b\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"Guestbook")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"GuestbookList")," \u3002",(0,r.kt)("inlineCode",{parentName:"p"},"Guestbook")," \u662f\u4e00\u4e2a\u6839\u7c7b\u578b\uff0c\u5b83\u63cf\u8ff0\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"Guestbook"),"\u79cd\u7c7b\u3002\u50cf\u6240\u6709 k8s \u5bf9\u8c61\uff0c\u5b83\u5305\u542b ",(0,r.kt)("inlineCode",{parentName:"p"},"TypeMeta")," (\u63cf\u8ff0\u4e86 API \u7248\u672c\u548c\u79cd\u7c7b),\u4e5f\u5305\u542b\u5176\u4e2d\u62e5\u6709\u50cf\u540d\u79f0\uff0c\u540d\u79f0\u7a7a\u95f4\u548c\u6807\u7b7e\u7684\u4e1c\u897f\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"ObjectMeta"),"\u3002\n",(0,r.kt)("inlineCode",{parentName:"p"},"GuestbookList")," \u53ea\u662f\u591a\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"Guestbook")," \u7684\u5bb9\u5668\uff0c\u5b83\u662f\u6279\u91cf\u64cd\u4f5c\u4e2d\u4f7f\u7528\u7684\u79cd\u7c7b\uff0c\u50cf List \u3002"),(0,r.kt)("p",null,"\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u4ece\u4e0d\u4fee\u6539\u4efb\u4f55\u4e00\u4e2a -- \u6240\u6709\u4fee\u6539\u90fd\u8981\u5230 ",(0,r.kt)("inlineCode",{parentName:"p"},"Spec")," \u6216\u8005 ",(0,r.kt)("inlineCode",{parentName:"p"},"Status"),"\u3002"),(0,r.kt)("p",null,"\u90a3\u4e2a\u5c0f\u5c0f\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"+kubebuilder:object:root")," \u6ce8\u91ca\u88ab\u79f0\u4e3a\u6807\u8bb0\u3002\u6211\u4eec\u5c06\u4f1a\u770b\u5230\u66f4\u591a\u7684\u5b83\u4eec\uff0c\u4f46\u8981\u77e5\u9053\u5b83\u4eec\u5145\u5f53\u989d\u5916\u7684\u5143\u6570\u636e\uff0c\u544a\u8bc9 ",(0,r.kt)("inlineCode",{parentName:"p"},"controller-root")," (\u6211\u4eec\u7684\u4ee3\u7801\u548cYAML\u751f\u6210\u5668)\u989d\u5916\u7684\u4fe1\u606f\u3002\u8fd9\u4e2a\u7279\u5b9a\u7684\u6807\u7b7e\u544a\u8bc9 ",(0,r.kt)("inlineCode",{parentName:"p"},"object")," \u751f\u6210\u5668\u8fd9\u4e2a\u7c7b\u578b\u8868\u793a\u4e00\u4e2a\u79cd\u7c7b\u3002\u7136\u540e\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"object"),"\u751f\u6210\u5668\u4e3a\u6211\u4eec\u751f\u6210\u8fd9\u4e2a\u6240\u6709\u8868\u793a\u79cd\u7c7b\u7684\u7c7b\u578b\u4e00\u5b9a\u8981\u5b9e\u73b0\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"runtime.Object")," \u63a5\u53e3\u7684\u5b9e\u73b0\u3002"),(0,r.kt)("h1",a({},{id:"\u6d4b\u8bd5"}),"\u6d4b\u8bd5"),(0,r.kt)("p",null,"\u5c06 CRD \u5b89\u88c5\u5230\u96c6\u7fa4\u4e2d"),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-bash"}),"make install\n")),(0,r.kt)("p",null,"\u8fd0\u884c\u63a7\u5236\u5668\uff08\u8fd9\u5c06\u5728\u524d\u53f0\u8fd0\u884c\uff0c\u5982\u679c\u4f60\u60f3\u8ba9\u5b83\u4e00\u76f4\u8fd0\u884c\uff0c\u8bf7\u5207\u6362\u5230\u65b0\u7684\u7ec8\u7aef\uff09\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-bash"}),"make run\n")),(0,r.kt)("h2",a({},{id:"\u5b89\u88c5-cr-\u5b9e\u4f8b"}),"\u5b89\u88c5 CR \u5b9e\u4f8b"),(0,r.kt)("p",null,"\u5982\u679c\u4f60\u6309\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"y")," \u521b\u5efa\u8d44\u6e90 ","[y/n]","\uff0c\u90a3\u4e48\u4f60\u5c31\u4e3a\u793a\u4f8b\u4e2d\u7684\u81ea\u5b9a\u4e49\u8d44\u6e90\u5b9a\u4e49 ",(0,r.kt)("inlineCode",{parentName:"p"},"CRD")," \u521b\u5efa\u4e86\u4e00\u4e2a\u81ea\u5b9a\u4e49\u8d44\u6e90 ",(0,r.kt)("inlineCode",{parentName:"p"},"CR")," \uff08\u5982\u679c\u4f60\u66f4\u6539\u4e86 API \u5b9a\u4e49\uff0c\u8bf7\u52a1\u5fc5\u5148\u7f16\u8f91\u5b83\u4eec\uff09\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-bash"}),"kubectl apply -f config/samples/\n")),(0,r.kt)("h2",a({},{id:"\u5982\u4f55\u5728\u96c6\u7fa4\u4e2d\u8fd0\u884c"}),"\u5982\u4f55\u5728\u96c6\u7fa4\u4e2d\u8fd0\u884c"),(0,r.kt)("p",null,"\u6784\u5efa\u5e76\u63a8\u9001\u4f60\u7684\u955c\u50cf\u5230 \u4f60\u6307\u5b9a\u7684\u955c\u50cf\u4ed3\u5e93"),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-bash"}),"make docker-build docker-push IMG=<your-registry>/<project-name>:tag\n")),(0,r.kt)("p",null,"\u6839\u636e IMG \u6307\u5b9a\u7684\u955c\u50cf\u5c06\u63a7\u5236\u5668\u90e8\u7f72\u5230\u96c6\u7fa4\u4e2d"),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-bash"}),"make deploy IMG=<your-registry>/<project-name>:tag\n")))}m.isMDXComponent=!0}}]);