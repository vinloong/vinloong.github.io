"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3343],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=r.createContext({}),u=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(p.Provider,{value:t},e.children)},s="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),s=u(n),m=o,f=s["".concat(p,".").concat(m)]||s[m]||d[m]||a;return n?r.createElement(f,i(i({ref:t},c),{},{components:n})):r.createElement(f,i({ref:t},c))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=m;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[s]="string"==typeof e?e:o,i[1]=l;for(var u=2;u<a;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},3446:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>p,toc:()=>c});n(7294);var r=n(3905);function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o.apply(this,arguments)}function a(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}const i={index:!1,icon:"devops",title:"\u4e24\u6b65\u9a8c\u8bc1(2FA)",date:new Date("2022-03-11T00:00:00.000Z"),category:["dev&ops"],tag:["2FA"]},l="\u542f\u7528\u4e24\u6b65\u9a8c\u8bc1(2FA)\u4fdd\u62a4\u4f60\u7684SSH\u8fde\u63a5",p={unversionedId:"dev&ops/two-factor-authentication",id:"dev&ops/two-factor-authentication",title:"\u4e24\u6b65\u9a8c\u8bc1(2FA)",description:"\u53cc\u91cd\u8ba4\u8bc1\uff08\u82f1\u8bed\uff1aTwo-factor authentication\uff0c\u7f29\u5199\u4e3a2FA\uff09\uff0c\u53c8\u8bd1\u4e3a\u53cc\u91cd\u9a8c\u8bc1\u3001\u53cc\u56e0\u5b50\u8ba4\u8bc1\u3001\u53cc\u56e0\u7d20\u8ba4\u8bc1\u3001\u4e8c\u5143\u8ba4\u8bc1\uff0c\u53c8\u79f0\u4e24\u6b65\u9aa4\u9a8c\u8bc1\uff082-Step Verification\uff0c\u53c8\u8bd1\u4e24\u6b65\u9a8c\u8bc1\uff09\uff0c\u662f\u4e00\u79cd\u8ba4\u8bc1\u65b9\u6cd5\uff0c\u4f7f\u7528\u4e24\u79cd\u4e0d\u540c\u7684\u5143\u7d20\uff0c\u5408\u5e76\u5728\u4e00\u8d77\uff0c\u6765\u786e\u8ba4\u7528\u6237\u7684\u8eab\u4efd\uff0c\u662f\u591a\u56e0\u7d20\u9a8c\u8bc1\u4e2d\u7684\u4e00\u4e2a\u7279\u4f8b\u3002",source:"@site/docs/dev&ops/two-factor-authentication.md",sourceDirName:"dev&ops",slug:"/dev&ops/two-factor-authentication",permalink:"/docs/dev&ops/two-factor-authentication",draft:!1,tags:[],version:"current",lastUpdatedAt:1675912862,formattedLastUpdatedAt:"2023\u5e742\u67089\u65e5",frontMatter:{index:!1,icon:"devops",title:"\u4e24\u6b65\u9a8c\u8bc1(2FA)",date:"2022-03-11T00:00:00.000Z",category:["dev&ops"],tag:["2FA"]},sidebar:"dev&ops",previous:{title:"sublime \u4f7f\u7528\u6280\u5de7",permalink:"/docs/dev&ops/sublime"},next:{title:"vs studio \u79bb\u7ebf\u5b89\u88c5",permalink:"/docs/dev&ops/vs_community-install-offline"}},u={},c=[],s={toc:c},d="wrapper";function m(e){var{components:t}=e,n=a(e,["components"]);return(0,r.kt)(d,o({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",o({},{id:"\u542f\u7528\u4e24\u6b65\u9a8c\u8bc12fa\u4fdd\u62a4\u4f60\u7684ssh\u8fde\u63a5"}),"\u542f\u7528\u4e24\u6b65\u9a8c\u8bc1(2FA)\u4fdd\u62a4\u4f60\u7684SSH\u8fde\u63a5"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u53cc\u91cd\u8ba4\u8bc1\uff08\u82f1\u8bed\uff1aTwo-factor authentication\uff0c\u7f29\u5199\u4e3a2FA\uff09\uff0c\u53c8\u8bd1\u4e3a\u53cc\u91cd\u9a8c\u8bc1\u3001\u53cc\u56e0\u5b50\u8ba4\u8bc1\u3001\u53cc\u56e0\u7d20\u8ba4\u8bc1\u3001\u4e8c\u5143\u8ba4\u8bc1\uff0c\u53c8\u79f0\u4e24\u6b65\u9aa4\u9a8c\u8bc1\uff082-Step Verification\uff0c\u53c8\u8bd1\u4e24\u6b65\u9a8c\u8bc1\uff09\uff0c\u662f\u4e00\u79cd\u8ba4\u8bc1\u65b9\u6cd5\uff0c\u4f7f\u7528\u4e24\u79cd\u4e0d\u540c\u7684\u5143\u7d20\uff0c\u5408\u5e76\u5728\u4e00\u8d77\uff0c\u6765\u786e\u8ba4\u7528\u6237\u7684\u8eab\u4efd\uff0c\u662f\u591a\u56e0\u7d20\u9a8c\u8bc1\u4e2d\u7684\u4e00\u4e2a\u7279\u4f8b\u3002")),(0,r.kt)("p",null,"\u4e8c\u6b21\u9a8c\u8bc1\u662f\u76ee\u524d\u6bd4\u8f83\u5e38\u7528\u7684\u5b89\u5168\u624b\u6bb5\uff0c\u901a\u8fc7\u8bbe\u7f6e\u4e8c\u6b21\u9a8c\u8bc1\uff0c\u6211\u4eec\u53ef\u4ee5\u6709\u6548\u7684\u907f\u514d\u8d26\u6237\u5bc6\u7801\u53ef\u80fd\u7684\u6cc4\u9732\u5bfc\u81f4\u7684\u8d26\u6237\u4fe1\u606f\u6cc4\u9732\uff0c\u56e0\u4e3a\u6bcf\u6b21\u767b\u9646\u524d\u6211\u4eec\u90fd\u9700\u8981\u83b7\u53d6\u4e00\u4e2a\u4e00\u6b21\u6027\u9a8c\u8bc1\u7801\uff0c\u6ca1\u6709\u9a8c\u8bc1\u7801\u5c31\u65e0\u6cd5\u6210\u529f\u767b\u9646\u3002\u672c\u6587\u5c06\u8bf4\u660e\u5982\u4f55\u5728 Ubuntu 20.04 TLS \u4e0a\u4f7f\u7528 Google Authenticator PAM \u6a21\u5757\u8fdb\u884c SSH \u548c sudo \u8eab\u4efd\u9a8c\u8bc1\u3002"),(0,r.kt)("h1",o({},{id:"\u51c6\u5907\u5de5\u4f5c"}),"\u51c6\u5907\u5de5\u4f5c"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Ubuntu 20.04 LTS \u670d\u52a1\u5668"),(0,r.kt)("li",{parentName:"ul"},"\u4e8c\u6b21\u9a8c\u8bc1 App\uff0c\u6bd4\u5982\u8c37\u6b4c\u7684"),(0,r.kt)("li",{parentName:"ul"},"SSH \u6743\u9650")),(0,r.kt)("h1",o({},{id:"\u5b89\u88c5-pam-\u6a21\u5757"}),"\u5b89\u88c5 PAM \u6a21\u5757"),(0,r.kt)("p",null,"\u901a\u8fc7 SSH \u767b\u9646 Ubuntu 20.04 TLS \u7cfb\u7edf\uff0c\u4f7f\u7528\u4e0b\u9762\u547d\u4ee4\u5b89\u88c5 Google Authenticator PAM \u6a21\u5757\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",o({parentName:"pre"},{className:"language-shell"}),"$ sudo apt update && sudo apt-get install libpam-google-authenticator\n")),(0,r.kt)("p",null,"\u5b89\u88c5\u597d\u540e\uff0c\u76f4\u63a5\u5728\u547d\u4ee4\u884c\u4e2d\u8fd0\u884c ",(0,r.kt)("inlineCode",{parentName:"p"},"google-authenticator")),(0,r.kt)("p",null,"\u9009\u9879\u8bf4\u660e\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"-t : \u4f7f\u7528 TOTP \u9a8c\u8bc1"),(0,r.kt)("li",{parentName:"ul"},"-f : \u5c06\u914d\u7f6e\u4fdd\u5b58\u5230 ",(0,r.kt)("inlineCode",{parentName:"li"},"~/.google_authenticator")),(0,r.kt)("li",{parentName:"ul"},"-d : \u4e0d\u5141\u8bb8\u91cd\u590d\u4f7f\u7528\u4ee5\u524d\u4f7f\u7528\u7684\u4ee4\u724c"),(0,r.kt)("li",{parentName:"ul"},"-w 3 : \u5141\u8bb8\u7684\u4ee4\u724c\u7684\u7a97\u53e3\u5927\u5c0f\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4ee4\u724c\u6bcf 30 \u79d2\u8fc7\u671f\u4e00\u6b21\u3002 \u7a97\u53e3\u5927\u5c0f 3 \u5141\u8bb8\u5728\u5f53\u524d\u4ee4\u724c\u4e4b\u524d\u548c\u4e4b\u540e\u4f7f\u7528\u4ee4\u724c\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u4ee5\u8fdb\u884c\u65f6\u949f\u504f\u79fb\u3002"),(0,r.kt)("li",{parentName:"ul"},"-e 10 : \u751f\u6210 10 \u4e2a\u7d27\u6025\u5907\u7528\u4ee3\u7801"),(0,r.kt)("li",{parentName:"ul"},"-r 3 -R 30 : \u9650\u901f\uff0c\u6bcf 30 \u79d2\u5141\u8bb8 3 \u6b21\u767b\u5f55")),(0,r.kt)("p",null,"\u66f4\u591a\u5e2e\u52a9\u4fe1\u606f\u53ef\u4ee5\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"--help")," \u9009\u9879\u67e5\u770b"),(0,r.kt)("pre",null,(0,r.kt)("code",o({parentName:"pre"},{className:"language-shell"}),"$ google-authenticator -t -f -d -w 3 -e 10 -r 3 -R 30 \n\n\n")),(0,r.kt)("p",null,"\u5b83\u4f1a\u63d0\u793a\u4f60\u662f\u5426\u751f\u6210\u57fa\u4e8e\u65f6\u95f4\u7684 Token\uff0c\u8fd9\u65f6\u5019\u6839\u636e\u4f60\u7684\u559c\u597d\u9009\u62e9\uff0c\u6211\u8fd9\u91cc\u9009\u62e9\u662f\uff0c\u8f93\u5165Y\u3002"),(0,r.kt)("p",null,"\u6b64\u65f6\u4f1a\u51fa\u73b0\u4e00\u5f20\u4e8c\u7ef4\u7801\u56fe\u7247\uff0c\u6211\u4eec\u8fd9\u65f6\u5019\u6253\u5f00\u521a\u521a\u4e0b\u8f7d\u7684\u8eab\u4efd\u9a8c\u8bc1\u5668\uff0c\u70b9\u51fb\u53f3\u4e0b\u89d2\u7684\u52a0\u53f7\uff0c\u9009\u62e9\u201c\u626b\u63cf\u6761\u5f62\u7801\u201d\uff0c\u7136\u540e\u5c06 SSH \u7a97\u53e3\u653e\u5927\uff0c\u7528\u6444\u50cf\u5934\u626b\u63cf\u51fa\u73b0\u7684\u4e8c\u7ef4\u7801\uff0c\u6b64\u65f6\u5c31\u4f1a\u591a\u51fa\u4e00\u4e2a\u8d26\u53f7\u4fe1\u606f\uff08\u516d\u4f4d\u6570\u7684\u52a8\u6001\u7801\uff09\uff0c\u53e6\u5916\u8bb0\u5f97\u59a5\u5584\u4fdd\u5b58\u4f60\u7684",(0,r.kt)("inlineCode",{parentName:"p"},"Emergency Key")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u5982\u679c\u6210\u529f\u626b\u63cf\u7684\u8bdd\u5c31\u53ef\u8df3\u8fc7\u6b64\u6b65\uff0c\u5982\u679c\u4f60\u65e0\u6cd5\u626b\u63cf\u4e8c\u7ef4\u7801\u7684\u8bdd\uff0c\u8bf7\u70b9\u51fb\u4e0b\u65b9\u7684\u201c\u8f93\u5165\u63d0\u4f9b\u7684\u5bc6\u94a5\u201d")),(0,r.kt)("p",null,"\u8d26\u53f7\u540d\u968f\u4fbf\u8f93\u5165\uff0c\u4e0d\u8fc7\u5efa\u8bae\u53d6\u4e00\u4e2a\u5bb9\u6613\u8bb0\u4f4f\u7684\u540d\u5b57\uff0c\u201c\u60a8\u7684\u5bc6\u94a5\u201d\u4e00\u680f\u8f93\u5165\u4e8c\u7ef4\u7801\u4e0b\u9762\u8ddf\u7740\u7684\u90a3\u4e32",(0,r.kt)("inlineCode",{parentName:"p"},"Your new secret key is"),"\u540e\u9762\u7684\u5185\u5bb9\uff0c\u201c\u65f6\u95f4\u9009\u9879\u201d\u91cc\u9762\uff0c\u5982\u679c\u4f60\u5728\u7b2c\u4e00\u6b65\u8f93\u5165\u4e86Y\uff0c\u5c31\u9009\u62e9",(0,r.kt)("inlineCode",{parentName:"p"},"\u57fa\u4e8e\u65f6\u95f4"),"\uff0c\u5426\u5219\u5c31\u9009",(0,r.kt)("inlineCode",{parentName:"p"},"\u57fa\u4e8e\u8ba1\u6570\u5668"),"\uff0c\u5b8c\u6210\u540e\u70b9\u51fb\u6dfb\u52a0\u3002"),(0,r.kt)("p",null,"\u63d0\u793a",(0,r.kt)("inlineCode",{parentName:"p"},'Do you want me to update your "/home/wb/.google_authenticator" file? (y/n)'),"\uff0c\u8f93\u5165Y\u3002\n\u63a5\u4e0b\u6765\u63d0\u793a\u4f60\u662f\u5426\u8bbe\u7f6e\u4e3a\u52a8\u6001\u7801\u590d\u7528\uff0c\u4ee5\u9632\u6b62\u653b\u51fb\uff0c\u5f53\u7136\u9009Y\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",o({parentName:"pre"},{}),"Do you want to disallow multiple uses of the same authentication\ntoken? This restricts you to one login about every 30s, but it increases\nyour chances to notice or even prevent man-in-the-middle attacks (y/n) y\n")),(0,r.kt)("p",null,"\u63a5\u4e0b\u6765\u6211\u4e2a\u4eba\u63a8\u8350\u7b2c\u4e00\u9879\u9009\u62e9N\uff0c\u7b2c\u4e8c\u9879\u9009Y\uff0c\u8fd9\u6837\u53ef\u4ee5\u9632\u6b62\u653b\u51fb\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",o({parentName:"pre"},{}),"By default, a new token is generated every 30 seconds by the mobile app.\nIn order to compensate for possible time-skew between the client and the server,\nwe allow an extra token before and after the current time. This allows for a\ntime skew of up to 30 seconds between authentication server and client. If you\nexperience problems with poor time synchronization, you can increase the window\nfrom its default size of 3 permitted codes (one previous code, the current\ncode, the next code) to 17 permitted codes (the 8 previous codes, the current\ncode, and the 8 next codes). This will permit for a time skew of up to 4 minutes\nbetween client and server.\nDo you want to do so? (y/n) n\n\nIf the computer that you are logging into isn't hardened against brute-force\nlogin attempts, you can enable rate-limiting for the authentication module.\nBy default, this limits attackers to no more than 3 login attempts every 30s.\nDo you want to enable rate-limiting? (y/n) y\n")))}m.isMDXComponent=!0}}]);