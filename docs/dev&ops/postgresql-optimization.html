<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-dev&ops/postgresql-optimization">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">postgresql 优化 | Loong&#x27;s Wiki</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://vinloong.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://vinloong.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://vinloong.github.io/docs/dev&amp;ops/postgresql-optimization"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="postgresql 优化 | Loong&#x27;s Wiki"><meta data-rh="true" name="description" content="首先，考虑对系统内存进行升级或者扩容，缓存越多则对磁盘的IO越少，那么性能就越好；"><meta data-rh="true" property="og:description" content="首先，考虑对系统内存进行升级或者扩容，缓存越多则对磁盘的IO越少，那么性能就越好；"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://vinloong.github.io/docs/dev&amp;ops/postgresql-optimization"><link data-rh="true" rel="alternate" href="https://vinloong.github.io/docs/dev&amp;ops/postgresql-optimization" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://vinloong.github.io/docs/dev&amp;ops/postgresql-optimization" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Loong&#39;s Wiki RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Loong&#39;s Wiki Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Loong&#39;s Wiki JSON Feed">






<link rel="stylesheet" href="/katex/katex.min.css"><link rel="stylesheet" href="/assets/css/styles.dfd1a4d8.css">
<link rel="preload" href="/assets/js/runtime~main.ca161155.js" as="script">
<link rel="preload" href="/assets/js/main.048483f4.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Loong&#x27;s Wiki Logo" class="themedImage_ToTc themedImage--light_HNdA" height="32" width="32"><img src="/img/logo.svg" alt="Loong&#x27;s Wiki Logo" class="themedImage_ToTc themedImage--dark_i4oU" height="32" width="32"></div><b class="navbar__title text--truncate">Loong&#x27;s Wiki</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/category/docs">文档</a><a class="navbar__item navbar__link" href="/docs/kubernetes">kubernetes</a><a class="navbar__item navbar__link" href="/docs/linux">linux</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/dev&amp;ops/Jenkins-faq">dev&amp;ops</a><a class="navbar__item navbar__link" href="/docs/others/exerclse/01">others</a><a class="navbar__item navbar__link" href="/blog">博客</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">🔖 常用书签</a><ul class="dropdown__menu"><li class="dropdown-archived"><b>开源镜像站</b></li><li><a href="https://mirrors.ustc.edu.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">中国科学技术大学镜像站<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://mirrors.huaweicloud.com" target="_blank" rel="noopener noreferrer" class="dropdown__link">华为开源镜像站<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://developer.aliyun.com/mirror/" target="_blank" rel="noopener noreferrer" class="dropdown__link">阿里镜像站<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/vinloong/wiki" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.svg" alt="Loong&#x27;s Wiki Logo" class="themedImage_ToTc themedImage--light_HNdA" height="32" width="32"><img src="/img/logo.svg" alt="Loong&#x27;s Wiki Logo" class="themedImage_ToTc themedImage--dark_i4oU" height="32" width="32"><b>Loong&#x27;s Wiki</b></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/Jenkins-faq">Jenkins 遇到的问题和解决方案</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/dev&amp;ops/Prometheus/PromQL">Prometheus</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/WSL2 安装和使用">wsl install</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/dev&amp;ops/bigdata">bigdata</a><button aria-label="打开/收起侧边栏菜单「bigdata」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/dev&amp;ops/ceph">CEPH</a><button aria-label="打开/收起侧边栏菜单「CEPH」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/choco">choco install</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/devops-tools.md">CI/CD 工具链</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/dev&amp;ops/es/eck">es</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/faq">faq</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/ffaq">ffaq</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/flink">flink 三种部署模式</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/dev&amp;ops/git/FAQ">git</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/git-dev">Git使用手册</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/git">git</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/github-repositories">一些开源项目资源整理</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/dev&amp;ops/golang/base">golang</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/jenkins-in-k8s">jenkins in k8s</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/dev&amp;ops/kafka/kafka-common">kafka</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/matplotlib-start">JupyterLab quick start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/monting">monting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/nfs">搭建 NFS 服务器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/nginx-faq">nginx 限制IP访问</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/dev&amp;ops/nodejs/faq">nodejs</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/postgres">postgres install</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/dev&amp;ops/postgresql-optimization">postgresql 优化</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/dev&amp;ops/python/faq">python</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/sonarqube">sonarqube quick start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/sublime">sublime 使用技巧</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/two-factor-authentication">两步验证(2FA)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/vs_community-install-offline">vs studio 离线安装</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/windows-commands">command in windows</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/wsl">wsl</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/wsl2-install-systemd">wsl2 intall systemd</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev&amp;ops/用docker构建你的开发环境">WSL 快速入门</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">postgresql 优化</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>硬件升级</h1><p>首先，考虑对系统内存进行升级或者扩容，缓存越多则对磁盘的IO越少，那么性能就越好；
其次，如果应用系统于数据库在同一台主机中，可以考虑将两者分离，这个根据具体情况；</p><h1>系统定向配置</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置方法">配置方法<a href="#配置方法" class="hash-link" aria-label="配置方法的直接链接" title="配置方法的直接链接">​</a></h2><ol><li>配置：<code>data/postgresql.conf</code></li><li>也可以通过命令修改/查看参数：<code>ALTER SYSTEM SET</code> 、<code>SHOW [name | ALL];</code><div class="language-psql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-psql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- 修改配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ALTER SYSTEM SET</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查看当前配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SHOW [name | ALL]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT * FROM pg_settings WHERE pending_restart = true;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>另外还可以通过工具 <code>pgtune</code>  进行参数调优</li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="关键调优参数">关键调优参数<a href="#关键调优参数" class="hash-link" aria-label="关键调优参数的直接链接" title="关键调优参数的直接链接">​</a></h2><ul><li><p><code>max_connections</code> </p><blockquote><p>最大连接数，这个参数设置大小和work_mem有一些关系。配置的越高，可能会占用系统更多的内存。通常可以设置数百个连接，如果要使用上千个连接，建议配置连接池来减少开销。</p></blockquote></li><li><p><code>checkpoint_segments</code> ：检查点 segements，</p><blockquote></blockquote></li><li><p><code>work_mem</code> ： 工作内存，</p><blockquote></blockquote></li><li><p><code>random_page_cost</code> ： 随机页时间成本，</p><blockquote></blockquote></li><li><p>shared_buffers</p><blockquote></blockquote></li><li><p>Effective_cache_size</p><blockquote></blockquote></li><li></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="分析查询性能">分析查询性能<a href="#分析查询性能" class="hash-link" aria-label="分析查询性能的直接链接" title="分析查询性能的直接链接">​</a></h2><p>如果您的 SQL 语句执行得太慢，您想知道发生了什么以及如何修复它。在 SQL 中，很难看到引擎如何花费时间</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="explain">EXPLAIN<a href="#explain" class="hash-link" aria-label="EXPLAIN的直接链接" title="EXPLAIN的直接链接">​</a></h3><p>查看语句的执行计划</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">EXPLAIN</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">option</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> statement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">EXPLAIN</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">ANALYZE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> VERBOSE </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> statement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">where</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">option</span><span class="token plain"> can be one </span><span class="token keyword" style="color:#CF222E">of</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">ANALYZE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">boolean</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    VERBOSE </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">boolean</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BUFFERS </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">boolean</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SETTINGS </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">boolean</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中：</p><ul><li>ANALYZE 选项为TRUE 会实际执行SQL，并获得相应的查询计划，默认为FALSE。如果优化一些修改数据的SQL 需要真实的执行但是不能影响现有的数据，可以放在一个事务中，分析完成后可以直接回滚。</li><li>VERBOSE 选项为TRUE 会显示查询计划的附加信息，默认为FALSE。附加信息包括查询计划中每个节点（后面具体解释节点的含义）输出的列（Output），表的SCHEMA 信息，函数的SCHEMA 信息，表达式中列所属表的别名，被触发的触发器名称等。</li><li>BUFFERS 选项为TRUE 会显示关于缓存的使用信息，默认为FALSE。该参数只能与ANALYZE 参数一起使用。缓冲区信息包括共享块（常规表或者索引块）、本地块（临时表或者索引块）和临时块（排序或者哈希等涉及到的短期存在的数据块）的命中块数，更新块数，挤出块数。</li><li>SETTINGS：选项 v12+ ，并包括所有与输出中的默认值不同的性能相关参数。</li></ul><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">EXPLAIN</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">ANALYZE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">VERBOSE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BUFFERS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">SELECT</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessVersion&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#D73A49">*</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessHistories&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;id&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">AS</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessHistories.id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessHistories&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;procinst_id&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">AS</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessHistories.procinstId&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessHistories&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;form_data&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">AS</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessHistories.formData&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessHistories&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;create_at&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">AS</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessHistories.createAt&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessHistories&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;version_id&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">AS</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessHistories.versionId&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessHistories&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;apply_user&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">AS</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessHistories.applyUser&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">FROM</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">SELECT</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessVersion&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessVersion&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;process_id&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">AS</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;processId&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessVersion&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;deployment_id&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">AS</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;deploymentId&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessVersion&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;procdef_id&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">AS</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;procdefId&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessVersion&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;proc_key&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">AS</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;procKey&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessVersion&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;current&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessVersion&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;create_at&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">AS</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;createAt&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessVersion&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;form_id&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">AS</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;formId&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessVersion&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;bpmn_json&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">AS</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;bpmnJson&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">FROM</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflow_process_version&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">AS</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessVersion&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">WHERE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">SELECT</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;version_id&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">FROM</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflow_process_history&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">AS</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessHistories&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">WHERE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;workflowProcessHistories&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;procinst_id&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&#x27;2b38bb4a-db44-11ec-9537-82994f65ae9b&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">AND</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessHistories&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;version_id&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessVersion&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;id&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">10</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">IS</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#005CC5">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">AS</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessVersion&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">INNER</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">JOIN</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflow_process_history&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">AS</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessHistories&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">ON</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessVersion&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;id&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessHistories&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;version_id&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">AND</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;workflowProcessHistories&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#C6105F">&quot;procinst_id&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&#x27;2b38bb4a-db44-11ec-9537-82994f65ae9b&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://raw.githubusercontent.com/vinloong/imgchr/main/notes/img/202205292146134.png" class="img_ev3q"></p><p>生成的查询计划:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">QUERY PLAN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Nested Loop  (cost=0.00..274.74 rows=1 width=1488) (actual time=0.254..0.254 rows=0 loops=1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Output: &quot;workflowProcessVersion&quot;.id, &quot;workflowProcessVersion&quot;.process_id, &quot;workflowProcessVersion&quot;.deployment_id, &quot;workflowProcessVersion&quot;.procdef_id, &quot;workflowProcessVersion&quot;.proc_key, &quot;workflowProcessVersion&quot;.current, &quot;workflowProcessVersion&quot;.create_at, &quot;workflowProcessVersion&quot;.form_id, &quot;workflowProcessVersion&quot;.bpmn_json, &quot;workflowProcessHistories&quot;.id, &quot;workflowProcessHistories&quot;.procinst_id, &quot;workflowProcessHistories&quot;.form_data, &quot;workflowProcessHistories&quot;.create_at, &quot;workflowProcessHistories&quot;.version_id, &quot;workflowProcessHistories&quot;.apply_user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Join Filter: (&quot;workflowProcessVersion&quot;.id = &quot;workflowProcessHistories&quot;.version_id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Buffers: shared read=20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt;  Seq Scan on public.workflow_process_history &quot;workflowProcessHistories&quot;  (cost=0.00..23.94 rows=1 width=397) (actual time=0.253..0.253 rows=0 loops=1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Output: &quot;workflowProcessHistories&quot;.id, &quot;workflowProcessHistories&quot;.procinst_id, &quot;workflowProcessHistories&quot;.form_data, &quot;workflowProcessHistories&quot;.create_at, &quot;workflowProcessHistories&quot;.version_id, &quot;workflowProcessHistories&quot;.apply_user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Filter: ((&quot;workflowProcessHistories&quot;.procinst_id)::text = &#x27;2b38bb4a-db44-11ec-9537-82994f65ae9b&#x27;::text)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Rows Removed by Filter: 285</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Buffers: shared read=20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt;  Limit  (cost=0.00..250.57 rows=10 width=1091) (never executed)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Output: &quot;workflowProcessVersion&quot;.id, &quot;workflowProcessVersion&quot;.process_id, &quot;workflowProcessVersion&quot;.deployment_id, &quot;workflowProcessVersion&quot;.procdef_id, &quot;workflowProcessVersion&quot;.proc_key, &quot;workflowProcessVersion&quot;.current, &quot;workflowProcessVersion&quot;.create_at, &quot;workflowProcessVersion&quot;.form_id, &quot;workflowProcessVersion&quot;.bpmn_json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;  Seq Scan on public.workflow_process_version &quot;workflowProcessVersion&quot;  (cost=0.00..18567.58 rows=741 width=1091) (never executed)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              Output: &quot;workflowProcessVersion&quot;.id, &quot;workflowProcessVersion&quot;.process_id, &quot;workflowProcessVersion&quot;.deployment_id, &quot;workflowProcessVersion&quot;.procdef_id, &quot;workflowProcessVersion&quot;.proc_key, &quot;workflowProcessVersion&quot;.current, &quot;workflowProcessVersion&quot;.create_at, &quot;workflowProcessVersion&quot;.form_id, &quot;workflowProcessVersion&quot;.bpmn_json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              Filter: ((SubPlan 1) IS NOT NULL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              SubPlan 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                -&gt;  Limit  (cost=0.00..24.73 rows=1 width=4) (never executed)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      Output: &quot;workflowProcessHistories_1&quot;.version_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      -&gt;  Seq Scan on public.workflow_process_history &quot;workflowProcessHistories_1&quot;  (cost=0.00..24.73 rows=1 width=4) (never executed)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            Output: &quot;workflowProcessHistories_1&quot;.version_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            Filter: (((&quot;workflowProcessHistories_1&quot;.procinst_id)::text = &#x27;2b38bb4a-db44-11ec-9537-82994f65ae9b&#x27;::text) AND (&quot;workflowProcessHistories_1&quot;.version_id = &quot;workflowProcessVersion&quot;.id))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Planning Time: 1.076 ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Execution Time: 0.333 ms</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>pg 库构建出一个规划节点的树状结构，来表示不同的操作: 根节点和每个<code>-&gt;</code>指向一个操作：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Nested Loop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|___________ Seq Scan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|___________ Limit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               |______ Seq Scan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          |_____ Limit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   |____  Seq Scan</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>每个分支代表一个子动作，从里到外以确定哪个是“第一个”发生（尽管同一级别的节点顺序可能不同）</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="在explain-命令的输出结果中可能包含多种类型的执行节点我们可以大体分为几大类">在EXPLAIN 命令的输出结果中可能包含多种类型的执行节点，我们可以大体分为几大类：<a href="#在explain-命令的输出结果中可能包含多种类型的执行节点我们可以大体分为几大类" class="hash-link" aria-label="在EXPLAIN 命令的输出结果中可能包含多种类型的执行节点，我们可以大体分为几大类：的直接链接" title="在EXPLAIN 命令的输出结果中可能包含多种类型的执行节点，我们可以大体分为几大类：的直接链接">​</a></h2><ul><li>控制节点（Control Node)</li><li>扫描节点（ScanNode)</li><li>物化节点（Materialization Node)</li><li>连接节点（Join Node)</li></ul><p>为了更有针对性，本文只介绍扫描节点:</p><p>扫描节点，简单来说就是为了扫描表的元组，每次获取一条元组（Bitmap Index Scan除外）作为上层节点的输入。当然严格的说，不光可以扫描表，还可以扫描函数的结果集、链表结构、子查询结果集等。</p><p>目前在PostgreSQL 中支持：</p><ul><li><code>Seq Scan</code>: 全表顺序扫描，一般查询没有索引的表需要全表顺序扫描</li><li><code>Index Scan</code>: 是索引扫描，主要用来在WHERE 条件中存在索引列时的扫描</li><li><code>IndexOnly Scan</code>: 基于索引扫描，并且只返回索引列的值，简称为覆盖索引</li><li><code>BitmapIndex Scan</code>: 利用Bitmap 结构扫描</li><li><code>BitmapHeap Scan</code>: 把BitmapIndex Scan 返回的Bitmap 结构转换为元组结构</li><li><code>Tid Scan</code>: 用于扫描一个元组TID 数组</li><li><code>Subquery Scan</code>: 扫描一个子查询</li><li><code>Function Scan</code>: 处理含有函数的扫描</li><li><code>TableFunc Scan</code>: 处理tablefunc 相关的扫描</li><li><code>Values Scan</code>: 用于扫描Values 链表的扫描</li><li><code>Cte Scan</code>: 用于扫描WITH 字句的结果集</li><li><code>NamedTuplestore Scan</code>: 用于某些命名的结果集的扫描</li><li><code>WorkTable Scan</code>: 用于扫描Recursive Union 的中间数据</li><li><code>Foreign Scan</code>: 用于外键扫描</li><li><code>Custom Scan</code>: 用于用户自定义的扫描</li></ul><p>其中，最常用的几个：<code>Seq Scan</code>、<code>Index Scan</code>、<code>IndexOnly Scan</code>、<code>BitmapIndex Scan</code>、<code>BitmapHeap Scan</code>。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="结果分析">结果分析:<a href="#结果分析" class="hash-link" aria-label="结果分析:的直接链接" title="结果分析:的直接链接">​</a></h3><ul><li><p><code>Seq Scan on workflow_process_history</code> 说明了这个节点的类型和作用对象，即在 &#x27;<code>workflow_process_history</code>&#x27; 表上进行了全表扫描</p></li><li><p><code>(cost=0.00..24.73 rows=1 width=4)</code> 说明了这个节点的代价估计</p></li><li><p><code>(actual time=56.036..56.037 rows=0 loops=1)</code> 说明了这个节点的真实执行信息，当EXPLAIN 命令中的ANALYZE选项为on时，会输出该项内容</p></li><li><p><code>Output: ... ...</code>  说明 SQL 的输出结果集的各个列，当EXPLAIN 命令中的选项VERBOSE 为on时才会显示</p></li><li><p><code> Filter: (... ...)</code> 说明 Seq Scan 节点之上的Filter 操作，即全表扫描时对每行记录进行过滤操作 </p></li><li><p><code>Rows Removed by Filter: 285</code>  表明了过滤操作过滤了多少行记录，属于Seq Scan 节点的VERBOSE 信息，只有EXPLAIN 命令中的VERBOSE 选项为on 时才会显示</p></li><li><p><code>Buffers: shared read=20</code> 说明 从共享缓存中命中了 20 个BLOCK，属于Seq Scan 节点的BUFFERS 信息，只有EXPLAIN 命令中的BUFFERS 选项为on 时才会显示</p></li><li><p><code>Planning Time: 1.076 ms</code>  表示生成查询计划的时间</p></li><li><p><code>Execution Time: 0.333 ms</code> 表示实际的SQL 执行时间，其中不包括查询计划的生成时间</p></li><li><p>rows 代表预估的行数，</p></li><li><p>width 代表预估的结果宽度，单位为字节</p></li><li><p>actual time 执行时间，格式为xxx..xxx，在.. 之前的是该节点实际的启动时间，即找到符合该节点条件的第一个结果实际需要的时间，在..之后的是该节点实际的执行时间</p></li><li><p>rows 指的是该节点实际的返回行数</p></li><li><p>loops 指的是该节点实际的重启次数。如果一个计划节点在运行过程中，它的相关参数值（如绑定变量）发生了变化，就需要重新运行这个计划节点。</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="注意事项和限制">注意事项和限制<a href="#注意事项和限制" class="hash-link" aria-label="注意事项和限制的直接链接" title="注意事项和限制的直接链接">​</a></h2><ul><li><p>您不能EXPLAIN用于所有类型的语句：它仅支持SELECT, INSERT, UPDATE, DELETE, EXECUTE（准备好的语句）CREATE TABLE … AS和DECLARE（游标的）。</p></li><li><p>请注意，这EXPLAIN ANALYZE会显着增加查询执行时间的开销，因此如果语句花费更长的时间，请不要担心。</p></li><li><p>查询执行时间总是有一定的变化，因为在第一次执行期间数据可能不在缓存中。这就是为什么重复EXPLAIN ANALYZE几次并查看结果是否改变很有价值的原因。</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="在explain-analyze输出中关注什么">在EXPLAIN ANALYZE输出中关注什么<a href="#在explain-analyze输出中关注什么" class="hash-link" aria-label="在EXPLAIN ANALYZE输出中关注什么的直接链接" title="在EXPLAIN ANALYZE输出中关注什么的直接链接">​</a></h3><ul><li>查找花费大部分执行时间的节点。</li><li>找到估计行数与实际行数显着不同的最低节点。很多时候，这是性能不佳的原因，其他地方的执行时间长只是基于错误估计的错误计划选择的结果。“显着不同”通常意味着 10 倍左右。</li><li>使用删除许多行的过滤条件查找长时间运行的顺序扫描。这些都是很好的索引候选对象。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="分析工具">分析工具<a href="#分析工具" class="hash-link" aria-label="分析工具的直接链接" title="分析工具的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="depesz-的-explain-analyze-工具"><a href="https://explain.depesz.com/s/Jrno" target="_blank" rel="noopener noreferrer">depesz 的 EXPLAIN ANALYZE 工具</a><a href="#depesz-的-explain-analyze-工具" class="hash-link" aria-label="depesz-的-explain-analyze-工具的直接链接" title="depesz-的-explain-analyze-工具的直接链接">​</a></h3><p><img loading="lazy" src="https://raw.githubusercontent.com/vinloong/imgchr/main/notes/img/202205292216375.png" class="img_ev3q"></p><p>这个执行计划看起来与原始计划有些相似，但看上去好看点。有一些有用的附加功能：</p><ul><li>计算并显示每个节点的总执行时间和净执行时间。这可以为您节省很多工作！次数最多的节点用红色背景突出显示，很容易被发现。</li><li>在标题“行 x”下，您可以看到 PostgreSQL 高估或低估了行数的因素。错误的估计以红色背景突出显示。</li><li>如果您单击一个节点，它下面的所有内容都将隐藏。这使您可以忽略长期执行计划中无趣的部分并专注于重要的部分。</li><li>如果您将鼠标悬停在一个节点上，它的所有直接子节点都会以星号突出显示。这使得在大型执行计划中找到它们变得容易。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dalibo-的explain-analyze-工具"><a href="https://explain.dalibo.com" target="_blank" rel="noopener noreferrer">Dalibo 的EXPLAIN ANALYZE 工具</a><a href="#dalibo-的explain-analyze-工具" class="hash-link" aria-label="dalibo-的explain-analyze-工具的直接链接" title="dalibo-的explain-analyze-工具的直接链接">​</a></h3><p><img loading="lazy" src="https://raw.githubusercontent.com/vinloong/imgchr/main/notes/img/202205292219726.png" class="img_ev3q"></p><p>最初，显示会隐藏详细信息，但您可以通过单击一个节点来显示它们，就像我对上图中的第二个节点所做的那样。在左侧，您会看到所有节点的小概览，从那里您可以跳转到右侧以获取详细信息。增加价值的功能是：</p><ul><li>在左侧，您会看到表示相对净执行时间的条形图，让您可以专注于最昂贵的节点。</li><li>同样在左侧，您可以选择“估计”以查看 PostgreSQL 高估或低估了每行的行数。</li><li>最后，您可以单击“缓冲区”以查看哪些节点使用了最多的 8kB 块。这是有用的信息，因为它显示了执行时间取决于数据缓存情况的节点。</li><li>在右侧，您可以通过单击展开一个节点，并在多个选项卡中获取所有详细信息, 您可以通过单击隐藏在节点右下角的“十字准线”图标来折叠树中节点下的所有内容。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="一些结论">一些结论<a href="#一些结论" class="hash-link" aria-label="一些结论的直接链接" title="一些结论的直接链接">​</a></h2><ul><li>大多数情况下，Index Scan 要比 Seq Scan 快。但是如果获取的结果集占所有数据的比重很大时，这时Index Scan 因为要先扫描索引再读表数据反而不如直接全表扫描来的快。</li><li>如果获取的结果集的占比比较小，但是元组数很多时，可能Bitmap Index Scan 的性能要比Index Scan 好。</li><li>如果获取的结果集能够被索引覆盖，则Index Only Scan 因为不用去读数据，只扫描索引，性能一般最好。但是如果VM 文件未生成，可能性能就会比Index Scan 要差。</li></ul><p>上面的结论都是基于理论分析得到的结果，但是其实PostgreSQL 的EXPLAIN 命令中输出的cost，rows，width 等代价估计信息中已经展示了这些扫描节点或者其他节点的预估代价，通过对预估代价的比较，可以选择出最小代价的查询计划树。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2023-02-09T03:21:02.000Z">2023年2月9日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/dev&amp;ops/postgres"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">postgres install</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/dev&amp;ops/python/faq"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">python faq</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#配置方法" class="table-of-contents__link toc-highlight">配置方法</a></li><li><a href="#关键调优参数" class="table-of-contents__link toc-highlight">关键调优参数</a></li><li><a href="#分析查询性能" class="table-of-contents__link toc-highlight">分析查询性能</a><ul><li><a href="#explain" class="table-of-contents__link toc-highlight">EXPLAIN</a></li></ul></li><li><a href="#在explain-命令的输出结果中可能包含多种类型的执行节点我们可以大体分为几大类" class="table-of-contents__link toc-highlight">在EXPLAIN 命令的输出结果中可能包含多种类型的执行节点，我们可以大体分为几大类：</a><ul><li><a href="#结果分析" class="table-of-contents__link toc-highlight">结果分析:</a></li></ul></li><li><a href="#注意事项和限制" class="table-of-contents__link toc-highlight">注意事项和限制</a><ul><li><a href="#在explain-analyze输出中关注什么" class="table-of-contents__link toc-highlight">在EXPLAIN ANALYZE输出中关注什么</a></li></ul></li><li><a href="#分析工具" class="table-of-contents__link toc-highlight">分析工具</a><ul><li><a href="#depesz-的-explain-analyze-工具" class="table-of-contents__link toc-highlight">depesz 的 EXPLAIN ANALYZE 工具</a></li><li><a href="#dalibo-的explain-analyze-工具" class="table-of-contents__link toc-highlight">Dalibo 的EXPLAIN ANALYZE 工具</a></li></ul></li><li><a href="#一些结论" class="table-of-contents__link toc-highlight">一些结论</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/category/docs">文档</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 - 2024 loong's wiki, Inc. Built with <a href="https://docusaurus.io/zh-CN/">Docusaurus</a> .</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ca161155.js"></script>
<script src="/assets/js/main.048483f4.js"></script>
</body>
</html>