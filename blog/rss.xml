<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Loong's Wiki Blog</title>
        <link>https://vinloong.github.io/blog</link>
        <description>Loong's Wiki Blog</description>
        <lastBuildDate>Thu, 12 Jan 2023 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>zh-CN</language>
        <copyright>Copyright © 2023 Vinloong, Inc.</copyright>
        <item>
            <title><![CDATA[redia-ha]]></title>
            <link>https://vinloong.github.io/blog/2023/01/12/redia-ha</link>
            <guid>https://vinloong.github.io/blog/2023/01/12/redia-ha</guid>
            <pubDate>Thu, 12 Jan 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[Redis can be accessed via port 6379 and Sentinel can be accessed via port 26379 on the following DNS name from within your cluster:]]></description>
            <content:encoded><![CDATA[<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">redis-ha-haproxy.redis-ha.svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis-sentinel.redis-ha.svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis-cluster.redis-ha.svc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm fetch bitnami/redis --untar </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">--untardir ./</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm </span><span class="token function" style="color:#8250DF">install</span><span class="token plain"> redis-sentinel </span><span class="token builtin class-name" style="color:#116329">.</span><span class="token plain"> -n redis-ha</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Redis can be accessed via port 6379 and Sentinel can be accessed via port 26379 on the following DNS name from within your cluster:
<code>redis-ha.redis-ha.svc.cluster.local</code></p><p>To connect to your Redis server:</p><ol><li>To retrieve the redis password:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token builtin class-name" style="color:#116329">echo</span><span class="token plain"> </span><span class="token variable" style="color:#E36209">$(</span><span class="token variable" style="color:#E36209">kubectl get secret redis-ha -o </span><span class="token variable string" style="color:#C6105F">"jsonpath={.data['auth']}"</span><span class="token variable" style="color:#E36209"> </span><span class="token variable operator" style="color:#D73A49">|</span><span class="token variable" style="color:#E36209"> base64 --decode</span><span class="token variable" style="color:#E36209">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Connect to the Redis master pod that you can use as a client. By default the redis-ha-server-0 pod is configured as the master:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   kubectl </span><span class="token builtin class-name" style="color:#116329">exec</span><span class="token plain"> -it redis-ha-server-0 </span><span class="token function" style="color:#8250DF">sh</span><span class="token plain"> -n redis-ha</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Connect using the Redis CLI (inside container):</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   redis-cli -a </span><span class="token operator" style="color:#D73A49">&lt;</span><span class="token plain">REDIS-PASS-FROM-SECRET</span><span class="token operator" style="color:#D73A49">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong> Please be patient while the chart is being deployed </strong></p><p>Redis<!-- -->®<!-- --> can be accessed via port 6379 on the following DNS name from within your cluster:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">`redis-sentinel.redis-ha.svc.cluster.local` for read only operations</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For read/write operations, first access the Redis<!-- -->®<!-- --> Sentinel cluster, which is available in port 26379 using the same domain name above.</p><p>To get your password run:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name" style="color:#116329">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#E36209">REDIS_PASSWORD</span><span class="token operator" style="color:#D73A49">=</span><span class="token variable" style="color:#E36209">$(</span><span class="token variable" style="color:#E36209">kubectl get secret --namespace redis-ha redis-ha-passwd -o </span><span class="token variable assign-left variable" style="color:#E36209">jsonpath</span><span class="token variable operator" style="color:#D73A49">=</span><span class="token variable string" style="color:#C6105F">"{.data.redis-password}"</span><span class="token variable" style="color:#E36209"> </span><span class="token variable operator" style="color:#D73A49">|</span><span class="token variable" style="color:#E36209"> base64 -d</span><span class="token variable" style="color:#E36209">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To connect to your Redis<!-- -->®<!-- --> server:</p><ol><li>Run a Redis<!-- -->®<!-- --> pod that you can use as a client:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   kubectl run --namespace redis-ha redis-client --restart</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">'Never'</span><span class="token plain">  --env </span><span class="token assign-left variable" style="color:#E36209">REDIS_PASSWORD</span><span class="token operator" style="color:#D73A49">=</span><span class="token variable" style="color:#E36209">$REDIS_PASSWORD</span><span class="token plain">  --image docker.io/bitnami/redis:7.0.7-debian-11-r9 --command -- </span><span class="token function" style="color:#8250DF">sleep</span><span class="token plain"> infinity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Use the following </span><span class="token builtin class-name" style="color:#116329">command</span><span class="token plain"> to attach to the pod:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   kubectl </span><span class="token builtin class-name" style="color:#116329">exec</span><span class="token plain"> --tty -i redis-client </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   --namespace redis-ha -- </span><span class="token function" style="color:#8250DF">bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Connect using the Redis<!-- -->®<!-- --> CLI:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token assign-left variable" style="color:#E36209">REDISCLI_AUTH</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">"</span><span class="token string variable" style="color:#E36209">$REDIS_PASSWORD</span><span class="token string" style="color:#C6105F">"</span><span class="token plain"> redis-cli -h redis-sentinel -p </span><span class="token number" style="color:#005CC5">6379</span><span class="token plain"> </span><span class="token comment" style="color:#6B6B6B;font-style:italic"># Read only operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token assign-left variable" style="color:#E36209">REDISCLI_AUTH</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">"</span><span class="token string variable" style="color:#E36209">$REDIS_PASSWORD</span><span class="token string" style="color:#C6105F">"</span><span class="token plain"> redis-cli -h redis-sentinel -p </span><span class="token number" style="color:#005CC5">26379</span><span class="token plain"> </span><span class="token comment" style="color:#6B6B6B;font-style:italic"># Sentinel access</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To connect to your database from outside the cluster execute the following commands:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    kubectl port-forward --namespace redis-ha svc/redis-sentinel </span><span class="token number" style="color:#005CC5">6379</span><span class="token plain">:6379 </span><span class="token operator" style="color:#D73A49">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token assign-left variable" style="color:#E36209">REDISCLI_AUTH</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">"</span><span class="token string variable" style="color:#E36209">$REDIS_PASSWORD</span><span class="token string" style="color:#C6105F">"</span><span class="token plain"> redis-cli -h </span><span class="token number" style="color:#005CC5">127.0</span><span class="token plain">.0.1 -p </span><span class="token number" style="color:#005CC5">6379</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>k8s</category>
            <category>redis</category>
        </item>
        <item>
            <title><![CDATA[sealos start && ceph clean]]></title>
            <link>https://vinloong.github.io/blog/sealos ceph</link>
            <guid>https://vinloong.github.io/blog/sealos ceph</guid>
            <pubDate>Tue, 27 Dec 2022 00:00:00 GMT</pubDate>
            <content:encoded><![CDATA[<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#8250DF">wget</span><span class="token plain"> https://github.91chi.fun/https://github.com/labring/sealos/releases/download/v4.1.3/sealos_4.1.3_linux_amd64.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#8250DF">tar</span><span class="token plain"> -zxvf sealos_4.1.3_linux_amd64.tar.gz sealos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#8250DF">chmod</span><span class="token plain"> +x sealos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#8250DF">mv</span><span class="token plain"> sealos /usr/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sealos version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sealos apply -f Clusterfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sealos reset --cluster fs-cloud  --masters </span><span class="token number" style="color:#005CC5">10.8</span><span class="token plain">.40.125,10.8.40.126,10.8.40.129 --nodes </span><span class="token number" style="color:#005CC5">10.8</span><span class="token plain">.40.134,10.8.40.133,10.8.40.128,10.8.40.124 -p Freesun_123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sealos --cluster fs-cloud </span><span class="token function" style="color:#8250DF">add</span><span class="token plain"> --nodes </span><span class="token number" style="color:#005CC5">10.8</span><span class="token plain">.40.124</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#8250DF">mkdir</span><span class="token plain"> -p </span><span class="token environment constant" style="color:#005CC5">$HOME</span><span class="token plain">/.kube</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#8250DF">sudo</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">cp</span><span class="token plain"> -i /etc/kubernetes/admin.conf </span><span class="token environment constant" style="color:#005CC5">$HOME</span><span class="token plain">/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#8250DF">sudo</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">chown</span><span class="token plain"> </span><span class="token variable" style="color:#E36209">$(</span><span class="token variable function" style="color:#8250DF">id</span><span class="token variable" style="color:#E36209"> -u</span><span class="token variable" style="color:#E36209">)</span><span class="token builtin class-name" style="color:#116329">:</span><span class="token variable" style="color:#E36209">$(</span><span class="token variable function" style="color:#8250DF">id</span><span class="token variable" style="color:#E36209"> -g</span><span class="token variable" style="color:#E36209">)</span><span class="token plain"> </span><span class="token environment constant" style="color:#005CC5">$HOME</span><span class="token plain">/.kube/config</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl </span><span class="token builtin class-name" style="color:#116329">exec</span><span class="token plain"> -it -n rook-ceph rook-ceph-tools-5679b7d8f-8fpqj -- </span><span class="token function" style="color:#8250DF">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ceph status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cluster:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id:     b3282dee-82f6-4e2f-b89e-48c01077662b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    health: HEALTH_OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  services:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mon: </span><span class="token number" style="color:#005CC5">3</span><span class="token plain"> daemons, quorum a,b,d </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">age 31s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mgr: b</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">active, since 76s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, standbys: a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    osd: </span><span class="token number" style="color:#005CC5">3</span><span class="token plain"> osds: </span><span class="token number" style="color:#005CC5">3</span><span class="token plain"> up </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">since 76s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, </span><span class="token number" style="color:#005CC5">3</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">since 103s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  data:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pools:   </span><span class="token number" style="color:#005CC5">1</span><span class="token plain"> pools, </span><span class="token number" style="color:#005CC5">1</span><span class="token plain"> pgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    objects: </span><span class="token number" style="color:#005CC5">2</span><span class="token plain"> objects, </span><span class="token number" style="color:#005CC5">577</span><span class="token plain"> KiB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    usage:   </span><span class="token number" style="color:#005CC5">67</span><span class="token plain"> MiB used, </span><span class="token number" style="color:#005CC5">3.3</span><span class="token plain"> TiB / </span><span class="token number" style="color:#005CC5">3.3</span><span class="token plain"> TiB avail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pgs:     </span><span class="token number" style="color:#005CC5">1</span><span class="token plain"> active+clean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ceph osd status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ID  HOST      USED  AVAIL  WR OPS  WR DATA  RD OPS  RD DATA  STATE      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#005CC5">0</span><span class="token plain">  node-01  </span><span class="token number" style="color:#005CC5">22</span><span class="token plain">.1M  1117G      </span><span class="token number" style="color:#005CC5">0</span><span class="token plain">        </span><span class="token number" style="color:#005CC5">0</span><span class="token plain">       </span><span class="token number" style="color:#005CC5">0</span><span class="token plain">        </span><span class="token number" style="color:#005CC5">0</span><span class="token plain">   exists,up  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#005CC5">1</span><span class="token plain">  node-03  </span><span class="token number" style="color:#005CC5">22</span><span class="token plain">.2M  1117G      </span><span class="token number" style="color:#005CC5">0</span><span class="token plain">        </span><span class="token number" style="color:#005CC5">0</span><span class="token plain">       </span><span class="token number" style="color:#005CC5">0</span><span class="token plain">        </span><span class="token number" style="color:#005CC5">0</span><span class="token plain">   exists,up  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#005CC5">2</span><span class="token plain">  node-02  </span><span class="token number" style="color:#005CC5">22</span><span class="token plain">.1M  1117G      </span><span class="token number" style="color:#005CC5">0</span><span class="token plain">        </span><span class="token number" style="color:#005CC5">0</span><span class="token plain">       </span><span class="token number" style="color:#005CC5">0</span><span class="token plain">        </span><span class="token number" style="color:#005CC5">0</span><span class="token plain">   exists,up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ceph osd pool </span><span class="token function" style="color:#8250DF">ls</span><span class="token plain"> detail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pool </span><span class="token number" style="color:#005CC5">1</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">'.mgr'</span><span class="token plain"> replicated size </span><span class="token number" style="color:#005CC5">3</span><span class="token plain"> min_size </span><span class="token number" style="color:#005CC5">2</span><span class="token plain"> crush_rule </span><span class="token number" style="color:#005CC5">0</span><span class="token plain"> object_hash rjenkins pg_num </span><span class="token number" style="color:#005CC5">1</span><span class="token plain"> pgp_num </span><span class="token number" style="color:#005CC5">1</span><span class="token plain"> autoscale_mode on last_change </span><span class="token number" style="color:#005CC5">18</span><span class="token plain"> flags hashpspool stripe_width </span><span class="token number" style="color:#005CC5">0</span><span class="token plain"> pg_num_max </span><span class="token number" style="color:#005CC5">32</span><span class="token plain"> pg_num_min </span><span class="token number" style="color:#005CC5">1</span><span class="token plain"> application mgr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ rados </span><span class="token function" style="color:#8250DF">df</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POOL_NAME     USED  OBJECTS  CLONES  COPIES  MISSING_ON_PRIMARY  UNFOUND  DEGRADED  RD_OPS       RD  WR_OPS       WR  USED COMPR  UNDER COMPR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.mgr       </span><span class="token number" style="color:#005CC5">1.7</span><span class="token plain"> MiB        </span><span class="token number" style="color:#005CC5">2</span><span class="token plain">       </span><span class="token number" style="color:#005CC5">0</span><span class="token plain">       </span><span class="token number" style="color:#005CC5">6</span><span class="token plain">                   </span><span class="token number" style="color:#005CC5">0</span><span class="token plain">        </span><span class="token number" style="color:#005CC5">0</span><span class="token plain">         </span><span class="token number" style="color:#005CC5">0</span><span class="token plain">     </span><span class="token number" style="color:#005CC5">126</span><span class="token plain">  </span><span class="token number" style="color:#005CC5">109</span><span class="token plain"> KiB     </span><span class="token number" style="color:#005CC5">181</span><span class="token plain">  </span><span class="token number" style="color:#005CC5">2.9</span><span class="token plain"> MiB         </span><span class="token number" style="color:#005CC5">0</span><span class="token plain"> B          </span><span class="token number" style="color:#005CC5">0</span><span class="token plain"> B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total_objects    </span><span class="token number" style="color:#005CC5">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total_used       </span><span class="token number" style="color:#005CC5">67</span><span class="token plain"> MiB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total_avail      </span><span class="token number" style="color:#005CC5">3.3</span><span class="token plain"> TiB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total_space      </span><span class="token number" style="color:#005CC5">3.3</span><span class="token plain"> TiB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">重新安装 rook-ceph 重置磁盘状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#E36209">DISK</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">"/dev/sdX"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sgdisk --zap-all </span><span class="token variable" style="color:#E36209">$DISK</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#8250DF">dd</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#E36209">if</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">/dev/zero </span><span class="token assign-left variable" style="color:#E36209">of</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">"</span><span class="token string variable" style="color:#E36209">$DISK</span><span class="token string" style="color:#C6105F">"</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#E36209">bs</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">1M </span><span class="token assign-left variable" style="color:#E36209">count</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">100</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#E36209">oflag</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">direct,dsync</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#6B6B6B;font-style:italic"># 如果是固态盘使用下面命令 替换上面 `dd` 命令</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blkdiscard </span><span class="token variable" style="color:#E36209">$DISK</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>sealos</category>
            <category>k8s</category>
            <category>ceph</category>
        </item>
    </channel>
</rss>